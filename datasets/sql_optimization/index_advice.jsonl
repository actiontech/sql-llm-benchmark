{"case_id": "1", "difficulty_level": "3","description": "业务case-测试联合索引字段顺序", "create_table_statements": "CREATE TABLE `gs_order_inn` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键',\n  `order_code` varchar(20) DEFAULT NULL COMMENT '订单编号',\n  `third_order_code` varchar(300) DEFAULT NULL COMMENT '第三方订单编码',\n  `inn_id` varchar(20) DEFAULT NULL,\n  `inn_name` varchar(100) DEFAULT NULL COMMENT '酒店名称',\n  `chain_id` varchar(20) DEFAULT NULL,\n  `room_type_id` varchar(20) DEFAULT NULL,\n  `room_type_name` varchar(100) DEFAULT NULL COMMENT '房间类型名称',\n  `third_roomtype_id` varchar(20) DEFAULT NULL,\n  `bk_meb_id` int(11) DEFAULT NULL COMMENT '预订人会员id',\n  `bk_name` varchar(300) DEFAULT NULL COMMENT '预订人姓名',\n  `bk_mobile` varchar(300) DEFAULT NULL COMMENT '预订人手机',\n  `bk_email` varchar(300) DEFAULT NULL COMMENT '预订人电子邮箱',\n  `bk_meb_type` int(6) DEFAULT NULL COMMENT '预订人会员类型',\n  `bk_card_no` varchar(50) DEFAULT NULL COMMENT '预订人卡号',\n  `bk_property_id` int(11) DEFAULT NULL COMMENT '预订人属性id',\n  `bk_protype_id` int(11) DEFAULT NULL COMMENT '预订人属性类型id',\n  `contact_name` varchar(100) DEFAULT NULL COMMENT '联系人姓名',\n  `contact_phone` varchar(100) DEFAULT NULL COMMENT '联系人电话号码',\n  `contact_email` varchar(100) DEFAULT NULL COMMENT '联系人电子邮箱',\n  `guests_name` varchar(500) DEFAULT NULL,\n  `guests_num` int(5) DEFAULT NULL COMMENT '客人数量',\n  `bk_ip` varchar(100) DEFAULT NULL COMMENT '预订人ip地址',\n  `supplier_id` int(5) DEFAULT NULL COMMENT '供应商信息id',\n  `assure_type` int(2) DEFAULT NULL COMMENT '担保类型',\n  `assure_meb_point` int(2) DEFAULT NULL COMMENT '会员担保积分',\n  `source_type` int(2) DEFAULT NULL COMMENT '预订来源，app，官网，M站，微信等',\n  `inner_remarks` varchar(1024) DEFAULT NULL COMMENT '员工内部备注',\n  `remarks` varchar(1024) DEFAULT NULL COMMENT '备注',\n  `order_state` int(2) unsigned DEFAULT NULL COMMENT '订单状态 （0待确认，1预订成功，2已取消，3预订未到，4已入住，5已完成，6确认失败）',\n  `activity_code` varchar(20) DEFAULT NULL,\n  `seller_id` int(11) DEFAULT NULL COMMENT '业绩销售员',\n  `pay_state` int(5) unsigned DEFAULT NULL COMMENT '支付状态 0未付款 1已付款 2退款处理中 3已退款',\n  `can_cancel` int(5) DEFAULT NULL COMMENT '是否可以取消',\n  `need_invoice` int(5) DEFAULT NULL COMMENT '是否需要发票',\n  `pay_type` int(2) DEFAULT NULL COMMENT '支付方式(0到付；1线上预付；2信用住)',\n  `orig_rate` double(10,2) DEFAULT NULL COMMENT '原价',\n  `total_rate` double(10,2) DEFAULT NULL COMMENT '总价',\n  `pay_rate` double(10,2) DEFAULT NULL COMMENT '支付价',\n  `disc_price` double(10,2) DEFAULT NULL COMMENT '优惠金额（根据资产子表）',\n  `rate_code` varchar(20) DEFAULT NULL COMMENT '价格代码',\n  `orig_arr_date` datetime DEFAULT NULL COMMENT '预计抵店时间',\n  `orig_dep_date` datetime DEFAULT NULL COMMENT '预计离店时间',\n  `arr_date` datetime DEFAULT NULL COMMENT '实际到店时间',\n  `dep_date` datetime DEFAULT NULL COMMENT '实际离店时间',\n  `day_length` int(5) DEFAULT NULL COMMENT '入住天数',\n  `room_qty` int(6) DEFAULT NULL COMMENT '房间数',\n  `can_cancel_time` datetime DEFAULT NULL COMMENT '取消截止时间',\n  `keep_date` datetime DEFAULT NULL COMMENT '保留时间',\n  `flag` int(6) DEFAULT NULL COMMENT '订单标志位 1可用 0不可用',\n  `create_time` datetime DEFAULT NULL COMMENT '创建时间',\n  `create_oprt` int(6) DEFAULT NULL COMMENT '创建人',\n  `update_time` datetime DEFAULT NULL COMMENT '修改时间',\n  `update_oprt` int(6) DEFAULT NULL COMMENT '修改人',\n  `channel_source_type` int(5) DEFAULT NULL COMMENT '订单渠道来源',\n  `external_id` varchar(100) DEFAULT NULL COMMENT '外部跟踪号',\n  `brand_id` varchar(20) DEFAULT NULL COMMENT '品牌编码',\n  `room_source_type` varchar(255) DEFAULT '7days' COMMENT '房源编码',\n  `city_code` varchar(255) DEFAULT NULL COMMENT '城市编码',\n  `charged_rate` decimal(10,2) DEFAULT NULL COMMENT '后付订单实扣金额',\n  `time_zone` varchar(16) DEFAULT NULL COMMENT '酒店时区',\n  `inn_eng_name` varchar(100) DEFAULT NULL COMMENT '酒店英文名称',\n  `room_type_eng_name` varchar(100) DEFAULT NULL COMMENT '房型英文名称',\n  `bk_last_name` varchar(100) DEFAULT NULL COMMENT '预订人英文姓（中文拼音姓）',\n  `bk_first_name` varchar(100) DEFAULT NULL COMMENT '预订人英文名（中文拼音名）',\n  `country_code` varchar(30) DEFAULT NULL COMMENT '国家编码',\n  `preference` varchar(255) DEFAULT NULL COMMENT '客户偏好（逗号隔开）',\n  `currency` varchar(30) DEFAULT 'CNY' COMMENT '币种：CNY-人民币',\n  `overtime_state` int(3) DEFAULT NULL COMMENT '超时状态（0无,1下单超时,2取消超时）',\n  `acc_state` int(3) DEFAULT NULL COMMENT '账单状态',\n  `concat_last_name` varchar(100) DEFAULT NULL COMMENT '联系人英文姓（中文拼音姓）',\n  `concat_first_name` varchar(100) DEFAULT NULL COMMENT '联系人英文名（中文拼音名）',\n  `channel_code` varchar(30) DEFAULT NULL COMMENT '酒店房态渠道来源',\n  `business_meb_id` int(11) DEFAULT NULL COMMENT '企业会员id',\n  `business_meb_type` int(11) DEFAULT NULL COMMENT '企业会员类型',\n  `min_pay_rate` decimal(10,2) DEFAULT NULL COMMENT '订单最低消费金额',\n  `min_live_days` int(5) DEFAULT NULL COMMENT '订单最低连住天数',\n  `order_type` int(5) DEFAULT '3' COMMENT '订单业务类型（2酒+景 3酒店 4酒+机）',\n  `sale_type` int(5) DEFAULT '1' COMMENT '销售类型（1单独销售 2捆绑礼包销售）',\n  `change_state` char(1) DEFAULT '0' COMMENT '变更状态',\n  `state1` char(1) DEFAULT NULL COMMENT '状态1',\n  `state2` char(1) DEFAULT NULL COMMENT '状态2',\n  `ext1` varchar(20) DEFAULT NULL COMMENT '扩展字段1',\n  `ext2` varchar(30) DEFAULT NULL COMMENT '扩展字段2',\n  `ext3` varchar(50) DEFAULT NULL COMMENT '扩展字段3',\n  `breakfast` json DEFAULT NULL COMMENT '早餐信息',\n  `ext4` varchar(80) DEFAULT NULL COMMENT '扩展信息4',\n  `ext5` json DEFAULT NULL COMMENT '扩展信息5',\n  `balance_ext` json DEFAULT NULL COMMENT '用于结算通扩展信息',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `order_inn_code_ind` (`order_code`) USING BTREE,\n  KEY `order_inn_meb_id_ind` (`bk_meb_id`) USING BTREE,\n  KEY `order_inn_chain_id_ind` (`chain_id`),\n  KEY `order_inn_order_state_ind` (`order_state`) USING BTREE,\n  KEY `order_inn_create_time_ind` (`create_time`),\n  KEY `order_inn_orig_arr_date_ind` (`orig_arr_date`),\n  KEY `order_inn_room_type_id` (`room_type_id`),\n  KEY `order_inn_source_type` (`source_type`),\n  KEY `IX_bk_meb_id` (`bk_meb_id`,`room_type_id`,`source_type`),\n  KEY `order_inn_channel_source_type` (`channel_source_type`),\n  KEY `order_inn_city_code` (`city_code`),\n  KEY `order_inn_sid` (`seller_id`),\n  KEY `order_inn_overtime_state` (`overtime_state`),\n  KEY `idx_gs_order_inn` (`update_time`),\n  KEY `order_inn_external_id` (`external_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=20659802 DEFAULT CHARSET=utf8 COMMENT='酒店订单主表（数据基本以客户提交内容）'", "sql": "select\n  COUNT(*)\nfrom\n  gs_order_inn  \nWHERE\n  (\n    bk_meb_id = 1000492\n    and flag = 0\n    and create_time >= '2023-02-29 00:00:00.0'\n    and source_type not in (129, 345)\n    and channel_source_type in (1, 2, 4)\n    and country_code = 'LT'\n    and sale_type <> 3\n    and (\n      ext1 is null\n      or ext1 not in ('02', '03')\n    )\n    and create_oprt = 1200\n  );", "columns_selectivity": "{\n    \"gs_order_inn\": {\n        \"bk_meb_id\": 60.0000%,\n        \"flag\": 0.2000%,\n        \"create_time\": 0.4000%,\n        \"source_type\": 1.2000%,\n        \"channel_source_type\": 2.0000%,\n        \"country_code\": 12.6000%,\n        \"sale_type\": 0.2000%,\n        \"ext1\": 0.0000%,\n        \"create_oprt\": 0.2000%\n    }\n}", "explain": "|id |select_type|table       |partitions|type|possible_keys                                                                                                  |key                 |key_len|ref  |rows|filtered|Extra      |\n|---|-----------|------------|----------|----|---------------------------------------------------------------------------------------------------------------|--------------------|-------|-----|----|--------|-----------|\n|1  |SIMPLE     |gs_order_inn|          |ref |order_inn_meb_id_ind,order_inn_create_time_ind,order_inn_source_type,IX_bk_meb_id,order_inn_channel_source_type|order_inn_meb_id_ind|5      |const|1   |5       |Using where|", "expected": "以下三种情况均可：\n1. 无性能问题，无索引建议\n2. 执行计划显示过滤率（filtere）过低，在gs_order_inn表的bk_meb_id，country_code，channel_source_type，flag，create_time列创建复合索引，以减少会表次数，要求左列顺序为bk_meb_id，country_code，channel_source_type\n3. 在gs_order_inn表的bk_meb_id, country_code, channel_source_type, create_oprt或flag, create_time列创建复合索引，要求左列顺序为bk_meb_id，country_code，channel_source_type"}
{"case_id": "2", "difficulty_level": "3","description": "业务case-测试深分页", "create_table_statements": "CREATE TABLE T_DERIVED_RULE (\n  DRID BIGINT NOT NULL AUTO_INCREMENT COMMENT '派生规则ID',\n  PROP VARCHAR(100) COMMENT '属性',\n  RATE_CODE VARCHAR(50) COMMENT '费率代码',\n  OFFSET1 INT COMMENT '偏移量1',\n  OFFSET2 INT COMMENT '偏移量2',\n  UNIT VARCHAR(50) COMMENT '单位',\n  RADIXPOINT INT COMMENT '小数点',\n  COUNTRULE VARCHAR(200) COMMENT '计数规则1',\n  RADIXPOINT2 INT COMMENT '小数点2',\n  COUNTRULE2 VARCHAR(200) COMMENT '计数规则2',\n  BASECODE VARCHAR(50) COMMENT '基准代码',\n  UNIT2 VARCHAR(50) COMMENT '单位2',\n  FIXEDTAIL2 VARCHAR(50) COMMENT '固定尾部2',\n  derivative_level INT COMMENT '派生层级',\n  PRIMARY KEY (DRID)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;", "sql": "select \n  t1.DRID, \n  t1.PROP, \n  t1.RATE_CODE, \n  t1.OFFSET1, \n  t1.OFFSET2, \n  t1.UNIT, \n  t1.RADIXPOINT, \n  t1.COUNTRULE, \n  t1.RADIXPOINT2, \n  t1.COUNTRULE2, \n  t1.BASECODE, \n  t1.UNIT2, \n  t1.FIXEDTAIL2, \n  t1.derivative_level \nfrom \n  T_DERIVED_RULE t1\ninner join (\n  select DRID\n  from T_DERIVED_RULE\n  limit 2284000, 500\n) t2 on t1.DRID = t2.DRID;", "columns_selectivity": "{\n    \"T_DERIVED_RULE\": [\n        {\n            \"DRID\": 100.0000%,\n            \"PROP\": 0.0160%,\n            \"RATE_CODE\": 0.0160%,\n            \"OFFSET1\": 0.5020%,\n            \"OFFSET2\": 0.2820%,\n            \"UNIT\": 0.0100%,\n            \"RADIXPOINT\": 0.0100%,\n            \"COUNTRULE\": 0.0120%,\n            \"RADIXPOINT2\": 0.0100%,\n            \"COUNTRULE2\": 0.0120%,\n            \"BASECODE\": 0.0120%,\n            \"UNIT2\": 0.0080%,\n            \"FIXEDTAIL2\": 0.0100%,\n            \"derivative_level\": 0.0100%\n        }\n    ]\n}", "explain": "|id |select_type|table         |partitions|type  |possible_keys|key    |key_len|ref    |rows   |filtered|Extra      |\n|---|-----------|--------------|----------|------|-------------|-------|-------|-------|-------|--------|-----------|\n|1  |PRIMARY    |<derived2>    |          |ALL   |             |       |       |       |895,504|100     |           |\n|1  |PRIMARY    |t1            |          |eq_ref|PRIMARY      |PRIMARY|8      |t2.DRID|1      |100     |           |\n|2  |DERIVED    |T_DERIVED_RULE|          |index |             |PRIMARY|8      |       |895,504|100     |Using index|", "expected": "无法通过创建索引解决SQL性能问题"}
{"case_id": "3", "difficulty_level": "3","description": "业务case-函数列测试", "create_table_statements": "CREATE TABLE `t_org_architecture` (\n  `ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键-自增长，组织id/部门id',\n  `EXTERNAL_DEPT_ID` int(11) DEFAULT NULL COMMENT '外部系统的部门id',\n  `external_code` varchar(64) DEFAULT NULL COMMENT '外部编码',\n  `code` varchar(64) DEFAULT NULL COMMENT '部门编码: 根据节点所处的层级来生成值，层级调整之后编码会参照上级编码而变;1 2 2 4 4 4 4 4 4 4 (共10级)规则',\n  `GRADE` varchar(32) DEFAULT NULL COMMENT '层级数: 不同层级数使用不同的规则; 1 2 2 4 4 规则',\n  `PARENT_ID` int(11) DEFAULT NULL COMMENT '上级节点id，根节点此值为null',\n  `NAME` varchar(64) DEFAULT NULL COMMENT '名称',\n  `SEQUENCE` int(11) DEFAULT NULL COMMENT '顺序值，从1开始',\n  `ROOT` bit(1) DEFAULT b'0' COMMENT '是否是根节点',\n  `LEAF` bit(1) DEFAULT b'0' COMMENT '是否是(叶节点)末节点',\n  `STATUS` tinyint(4) DEFAULT '1' COMMENT '状态, 0-无效，1-有效',\n  `BUSINESS` bit(1) DEFAULT NULL COMMENT '是否开业，0-未开业，1-开业',\n  `STORE_STATUS` tinyint(4) DEFAULT NULL COMMENT '状态: -1 开发 0 筹建中 1开业  2开业后退筹建  3 开业后解约 5 下线整改 6 售出未下线',\n  `SOURCE` tinyint(4) DEFAULT NULL COMMENT '1-铂涛，2-锦江，3-维也纳, 4-WeHotel',\n  `SYNC_OUT` bit(1) DEFAULT b'0' COMMENT '是否从其他系统同步，默认是当前系统维护',\n  `TYPE` tinyint(4) DEFAULT '0' COMMENT '类型: 1-部门(总部部门) | 2-区域分公司, 3-事业群 | 4-事业部 | 5-分店 6-外部企业 | 7-其他 | 8-战区 | 9-负责人 | 10-品牌BU',\n  `STORE_ID` varchar(256) DEFAULT NULL COMMENT '分店id，若该节点不是分店则为空',\n  `STORE_CODE` varchar(32) DEFAULT NULL COMMENT '分店编码，若该节点不是分店则为空',\n  `BRAND_ID` varchar(16) DEFAULT NULL COMMENT '品牌id',\n  `BRAND_NAME` varchar(32) DEFAULT NULL COMMENT '品牌名称',\n  `CITY_CODE` varchar(16) DEFAULT NULL COMMENT '(分店)所在的城市编码',\n  `CITY_NAME` varchar(32) DEFAULT NULL COMMENT '(分店)所在的城市名称',\n  `OPERATOR` varchar(64) DEFAULT NULL COMMENT '操作者: 实际用户id或者系统同步更新等',\n  `principal` varchar(32) DEFAULT NULL COMMENT '负责人',\n  `REMARK` varchar(256) DEFAULT NULL COMMENT '备注',\n  `UPDATE_DT` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间',\n  `CREATE_DT` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\n  `CATEGORY` tinyint(4) unsigned DEFAULT '0' COMMENT '组织分类，0-内部组织，1-外部组织，2-业务组织',\n  `VIENNA_PMS_CODE` varchar(64) DEFAULT NULL COMMENT '维也纳组织的PMSCODE',\n  `EXTERNAL_PARENT_DEPT_ID` int(11) DEFAULT NULL COMMENT '外部系统的父部门id',\n  `external_parent_code` varchar(64) DEFAULT NULL COMMENT '外部父编码',\n  `FULL_PATH` varchar(512) DEFAULT NULL COMMENT '全路径',\n  `parent_ids` varchar(512) DEFAULT NULL COMMENT '父ids',\n  `org_type_id` varchar(64) DEFAULT NULL COMMENT '中国区的组织类型id;中国区ehr同步透传。S000013:BG总部;S000014:BU矩阵;S000015:品牌BU;S000016:BU职能;S000017:门店;S000163:片区;S000164:总部[职能一级部门(中心)];S000165:总部;S000166:区域本部[区域];S000202:储备池;S000214:门店部门;S000255:省区;S000573:区域本部;',\n  `code_length` int(11) GENERATED ALWAYS AS (length(`code`)) STORED,\n  PRIMARY KEY (`ID`),\n  KEY `T_ORG_ARCHITECTURE_IDX_PARENT_ID` (`PARENT_ID`) USING BTREE,\n  KEY `T_ORG_ARCHITECTURE_IDX_STORE_ID` (`STORE_ID`) USING BTREE,\n  KEY `T_ORG_ARCHITECTURE_IDX_CODE` (`code`) USING BTREE,\n  KEY `IDX_EXTERNAL_DEPT_ID` (`EXTERNAL_DEPT_ID`) USING BTREE,\n  KEY `IDX_EXTERNAL_CODE` (`external_code`) USING BTREE,\n  KEY `idx_code_length_code` (`code_length`,`code`)\n) ENGINE=InnoDB AUTO_INCREMENT=10239565 DEFAULT CHARSET=utf8 COMMENT='组织架构表'", "sql": "SELECT\n          ID,\n          `NAME`,\n          `CODE`,\n          `TYPE`,\n          principal,\n          CATEGORY\n        FROM\n          t_org_architecture\n        WHERE\n          LEFT('745070056000500070090',  LENGTH(`CODE`)) = `CODE`\n        GROUP BY\n          LENGTH(`CODE`);", "columns_selectivity": "{\n    \"t_org_architecture\": [\n        {\n            \"ID\": 100.0000%,\n            \"NAME\": 100.0000%,\n            \"CODE\": 100.0000%,\n            \"TYPE\": 0.0080%,\n            \"principal\": 1.6000%,\n            \"CATEGORY\": 0.0040%\n        }\n    ]\n}", "explain": "|id |select_type|table             |partitions|type |possible_keys       |key                 |key_len|ref|rows  |filtered|Extra      |\n|---|-----------|------------------|----------|-----|--------------------|--------------------|-------|---|------|--------|-----------|\n|1  |SIMPLE     |t_org_architecture|          |index|idx_code_length_code|idx_code_length_code|200    |   |99,963|10      |Using where|", "expected": "以下两种情况均可：\n1. 无法通过索引解决SQL性能问题，函数导致索引失效\n2. 针对于全索引扫描问题，可以创建覆盖索引，在t_org_architecture表的code_length, code, NAME, TYPE, principal, CATEGORY列添加索引，且要求code_length、code列为左列"}
{"case_id": "4", "difficulty_level": "3","description": "业务case-范围列测试", "create_table_statements": "CREATE TABLE `m_membermain` (\n  `MebID` int(11) NOT NULL AUTO_INCREMENT,\n  `MebName` varchar(100) NOT NULL,\n  `Sex` varchar(20) DEFAULT NULL,\n  `Birthday` datetime(3) DEFAULT NULL,\n  `SaleGroupID` int(11) NOT NULL,\n  `SellerID` int(11) NOT NULL,\n  `MebType` int(11) DEFAULT NULL,\n  `Password` varchar(500) DEFAULT NULL,\n  `State` bit(1) DEFAULT NULL,\n  `MarkOperation` int(11) DEFAULT NULL,\n  `MarkOprtionHis` int(11) DEFAULT NULL,\n  `RegSource` int(11) DEFAULT NULL,\n  `Remark` varchar(1024) DEFAULT NULL,\n  `Flag` bit(1) DEFAULT NULL,\n  `CreateTime` datetime(3) DEFAULT NULL,\n  `CreateOprt` int(11) DEFAULT NULL,\n  `LastAccessTime` datetime(3) DEFAULT NULL,\n  `LastModifyTime` datetime(3) DEFAULT NULL,\n  `LastModifyOprt` int(11) DEFAULT NULL,\n  `ActiveCode` varchar(50) DEFAULT NULL,\n  `FeeFlag` int(11) DEFAULT NULL,\n  `FirstConsDate` datetime(3) DEFAULT NULL,\n  `First77ConsDate` datetime(3) DEFAULT NULL,\n  `ActivityRange` int(11) DEFAULT NULL,\n  `Photo` mediumblob,\n  `Auditing` int(11) DEFAULT NULL,\n  `Freeze` int(11) DEFAULT NULL,\n  `RecommendMebID` int(11) DEFAULT NULL,\n  `GiftBoxCount` int(11) DEFAULT NULL,\n  `Rights` int(11) DEFAULT NULL,\n  `OwnCorpMebID` int(11) DEFAULT NULL,\n  `JoinCorpMebTime` datetime(3) DEFAULT NULL,\n  `CorpMebFlag` int(11) DEFAULT NULL,\n  `JoinCorpMebOprtID` int(11) DEFAULT NULL,\n  `_PointFlag` int(11) DEFAULT NULL,\n  `GroupTypeID` tinyint(3) unsigned DEFAULT NULL,\n  `CertificateType` smallint(2) DEFAULT NULL,\n  `CertificateNo` varchar(100) DEFAULT NULL,\n  `Mobile` varchar(30) DEFAULT NULL,\n  `Email` varchar(100) DEFAULT NULL,\n  `JJ_MCCODE` int(11) DEFAULT NULL,\n  `PT_MEBID` int(11) DEFAULT NULL,\n  `LastNameEn` varchar(100) DEFAULT NULL,\n  `FirstNameEn` varchar(100) DEFAULT NULL,\n  `Nationality` varchar(10) DEFAULT NULL,\n  `Status` smallint(2) DEFAULT NULL,\n  `NickName` varchar(100) DEFAULT NULL,\n  `Avatar` varchar(100) DEFAULT NULL,\n  `RegistChainId` varchar(50) DEFAULT NULL,\n  `RegistChainName` varchar(255) DEFAULT NULL,\n  `RegistBranch` varchar(255) DEFAULT NULL,\n  `PartnerCardNo` varchar(64) DEFAULT NULL,\n  `PartnerCardType` int(11) DEFAULT NULL,\n  `Pioneer` varchar(100) DEFAULT NULL,\n  `MebLevelStart` date DEFAULT NULL,\n  `MebLevelEnd` date DEFAULT NULL,\n  `MebNameNew` varchar(255) DEFAULT NULL COMMENT '会员姓名，UTF-8编码加密',\n  `authState` smallint(2) DEFAULT NULL,\n  `primeLevel` int(11) DEFAULT NULL,\n  `primeLevelStart` datetime(3) DEFAULT NULL,\n  `primeLevelEnd` datetime(3) DEFAULT NULL,\n  `viennaLevel` int(11) DEFAULT NULL COMMENT '维也纳等级信息',\n  `CertificateNoNew` varchar(255) DEFAULT NULL COMMENT '加密证件号',\n  `idcardAndNotCertified` int(11) DEFAULT NULL COMMENT '维也纳合并会员,存在证件且非实名',\n  `mebNameSM4` varchar(255) DEFAULT NULL COMMENT '会员姓名SM4加密',\n  `mobileSM3` varchar(255) DEFAULT NULL COMMENT '会员手机SM3加密,用于检索',\n  `mobileSM4` varchar(255) DEFAULT NULL COMMENT '会员手机SM4加密',\n  `certificateNoSM3` varchar(255) DEFAULT NULL COMMENT '会员证件SM3加密',\n  `certificateNoSM4` varchar(255) DEFAULT NULL COMMENT '会员证件SM4加密',\n  PRIMARY KEY (`MebID`),\n  KEY `IX_m_membermain_Mobile` (`Mobile`),\n  KEY `IX_membermain_CertificateNoNew` (`CertificateNoNew`),\n  KEY `IX_membermain_CreateTime` (`CreateTime`),\n  KEY `IX_membermain_JJ_MCCODE` (`JJ_MCCODE`),\n  KEY `IX_MemberMain_Lastmodifytime` (`LastModifyTime`,`MebType`),\n  KEY `IX_membermain_Mail` (`Email`),\n  KEY `IX_membermain_NickName` (`NickName`),\n  KEY `IX_MemberMain_OwnCorpMebID` (`OwnCorpMebID`,`CorpMebFlag`),\n  KEY `IX_MemberMain_Seller` (`SellerID`,`SaleGroupID`),\n  KEY `IX_m_membermain_MobileSM3` (`mobileSM3`),\n  KEY `IX_m_membermain_MobileSM4` (`mobileSM4`),\n  KEY `IX_m_membermain_CertificateNoSM3` (`certificateNoSM3`),\n  KEY `IX_m_membermain_CertificateNoSM4` (`certificateNoSM4`),\n  KEY `ix_m_membermain_flag` (`Flag`)\n) ENGINE=InnoDB AUTO_INCREMENT=285380964 DEFAULT CHARSET=utf8mb4", "sql": "SELECT \n  count(DISTINCT MebID) \nFROM \n  m_membermain mm \nWHERE \n  mm.Flag <> 0 \n  AND mm.MebType IN (1, 2, 5, 6, 8) \n  AND MebID IS NOT NULL \n  AND CreateTime >= '2018-01-01 00:00:00' \n  AND CreateTime < '2018-01-02 00:00:00' \nLIMIT \n  1000;", "columns_selectivity": "{\n            \"CreateTime\" : 99.0820%,\n            \"Flag\" : 0.0040%,\n            \"MebType\" : 0.0120%,\n            \"MebID\" : 100.0000%\n          }", "explain": "|id |select_type|table|partitions|type |possible_keys                                                                                                                                                                                                                                                                                                                                                                   |key                     |key_len|ref|rows|filtered|Extra                             |\n|---|-----------|-----|----------|-----|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|-------|---|----|--------|----------------------------------|\n|1  |SIMPLE     |mm   |          |range|PRIMARY,IX_m_membermain_Mobile,IX_membermain_CertificateNoNew,IX_membermain_CreateTime,IX_membermain_JJ_MCCODE,IX_MemberMain_Lastmodifytime,IX_membermain_Mail,IX_membermain_NickName,IX_MemberMain_OwnCorpMebID,IX_MemberMain_Seller,IX_m_membermain_MobileSM3,IX_m_membermain_MobileSM4,IX_m_membermain_CertificateNoSM3,IX_m_membermain_CertificateNoSM4,ix_m_membermain_flag|IX_membermain_CreateTime|8      |   |195 |22.5    |Using index condition; Using where|", "expected": "以下两种情况均可：\n1. 当前查询性能满足要求，无需创建新索引\n2. 在m_membermain表的CreateTime，MebType，Flag列创建覆盖索引，要求 CreateTime为最做列，且提示替换现有的IX_membermain_CreateTime索引或提示出与现有索引存在冗余。"}
{"case_id": "5", "difficulty_level": "3","description": "业务case-索引重复测试", "create_table_statements": "CREATE TABLE `hotel_price_adjustment` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键自增ID',\n  `apply_id` varchar(50) DEFAULT NULL COMMENT '申请ID',\n  `brand_code` varchar(50) DEFAULT NULL COMMENT '品牌编码',\n  `brand_name` varchar(255) DEFAULT NULL COMMENT '品牌名称',\n  `hotel_code` varchar(50) DEFAULT NULL COMMENT '酒店编码',\n  `hotel_name` varchar(255) DEFAULT NULL COMMENT '酒店名称',\n  `currency` varchar(50) DEFAULT NULL COMMENT '货币编码',\n  `category` varchar(50) DEFAULT NULL COMMENT '房价码分类',\n  `rate_code` varchar(50) DEFAULT NULL COMMENT '房价码编码',\n  `rate_name` varchar(255) DEFAULT NULL COMMENT '房价码名称',\n  `price_array_type` varchar(50) DEFAULT NULL COMMENT '价格序列类别,P:百分比,A:固定值,V:固定加减值(只针对priceArray2进行计算)',\n  `price_array_code` varchar(50) DEFAULT '' COMMENT '价格序列对应的基础房价代码',\n  `price_array_sequence` varchar(50) DEFAULT '' COMMENT '价格序列计算方式,1:先算百分比,后算加法,2:先算加法,后算百分比(1:先乘后加,2:先加后乘)',\n  `price_array` decimal(10,4) DEFAULT NULL COMMENT '价格序列,百分比房价序列数值',\n  `price_array2` decimal(10,4) DEFAULT NULL COMMENT '价格序列,加法数值',\n  `date_segment` varchar(500) DEFAULT NULL COMMENT '[开始日期,结束日期],多个日期段',\n  `weeks` varchar(50) DEFAULT NULL COMMENT '适用星期[\"1\"星期天;\"2\"星期一;\"3\"星期二;\"4\"星期三;\"5\"星期四;\"6\"星期五;\"7\"星期六]',\n  `brand_maximum_price` decimal(20,4) DEFAULT NULL,\n  `brand_minimum_price` decimal(20,4) DEFAULT NULL,\n  `room_code` varchar(50) DEFAULT NULL COMMENT '房型编码',\n  `room_name` varchar(255) DEFAULT NULL COMMENT '房型名称',\n  `room_standard_price` decimal(20,4) DEFAULT NULL,\n  `pre_adjustment_price` decimal(20,4) DEFAULT NULL,\n  `adjusted_price` decimal(20,4) DEFAULT NULL,\n  `price_adjustment_range` decimal(20,4) DEFAULT NULL,\n  `occupancy` int(255) DEFAULT NULL COMMENT '计划级房量',\n  `status` varchar(10) DEFAULT NULL COMMENT '计划级房态',\n  `reason` varchar(500) DEFAULT NULL COMMENT '调价原因',\n  `approve_status` char(2) DEFAULT NULL COMMENT '审批状态,0:免审,1:待审核,2:审核中,3:通过,4:驳回,5关闭',\n  `approve_reason` varchar(500) DEFAULT NULL COMMENT '审批原因',\n  `operator` varchar(50) DEFAULT NULL COMMENT '操作人',\n  `create_time` datetime DEFAULT NULL COMMENT '创建时间',\n  `update_time` datetime DEFAULT NULL COMMENT '更新时间',\n  `CREATE_USER_ID` varchar(16) DEFAULT NULL COMMENT '创建人ID(统一认证的userId)',\n  `ROOM_CODES` text COMMENT '申请的所有房型代码,使用英文逗号分割',\n  `extra_rate` decimal(10,4) DEFAULT NULL COMMENT '统一加价',\n  PRIMARY KEY (`id`),\n  KEY `ix_hotel_price_adjustment_01` (`brand_code`,`hotel_code`,`rate_code`,`room_code`,`approve_status`),\n  KEY `ix_hotel_price_adjustment_04` (`CREATE_USER_ID`,`hotel_code`,`apply_id`),\n  KEY `ix_hotel_price_adjustment_05` (`apply_id`),\n  KEY `ix_hotel_price_adjustment_06` (`update_time`,`hotel_code`,`CREATE_USER_ID`,`apply_id`),\n  KEY `ix_hotel_price_adjustment_07` (`hotel_code`,`create_time`,`apply_id`),\n  KEY `ix_hotel_price_adjustment_08` (`CREATE_USER_ID`,`create_time`,`apply_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=9143968 DEFAULT CHARSET=utf8mb4 COMMENT='调价-审批流程主表';\n\nCREATE TABLE `price_adjustment_audit_job` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `apply_id` varchar(50) DEFAULT NULL COMMENT '申请ID',\n  `sequence` tinyint(4) DEFAULT NULL COMMENT '审批阶段1：一审，2：二审，3：三审，4：四审',\n  `stage_Type` tinyint(4) DEFAULT NULL COMMENT '触发类型，1：必须审核，2：满足条件审核,3：创建人审核',\n  `stage_status` tinyint(4) DEFAULT NULL COMMENT '当前审批阶段状态，0:免审，1：待审核，2：审核中，3：通过，4：驳回，5关闭',\n  `audit_Type` tinyint(4) DEFAULT NULL COMMENT '审核类型，1：所有人都需要审核，2：只需一人审核，3：所有岗位审核，4：只需一个岗位审核',\n  `job_id` varchar(32) DEFAULT NULL COMMENT '岗位ID',\n  `create_time` datetime DEFAULT NULL COMMENT '创建时间',\n  `update_time` datetime DEFAULT NULL COMMENT '更新时间',\n  PRIMARY KEY (`id`) USING BTREE,\n  KEY `IX_APPLY_ID` (`apply_id`) USING BTREE,\n  KEY `ix_price_adjustment_audit_job_01` (`job_id`,`apply_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=489715 DEFAULT CHARSET=utf8mb4 COMMENT='审批记录与用户岗位关系表';", "sql": "SELECT \n  COUNT(DISTINCT id) \nFROM \n  ( \n    SELECT id \n    FROM hotel_price_adjustment pa1 \n    WHERE HOTEL_CODE IN ('6199', 'JJXRSEH802967') \n    UNION \n    SELECT id \n    FROM hotel_price_adjustment pa1 \n    WHERE CREATE_USER_ID = '289865' \n  ) AS temp;", "columns_selectivity": "{\n    \"hotel_price_adjustment\": [\n        {\n            \"HOTEL_CODE\": 5.0000%,\n            \"id\": 100.0000%,\n            \"CREATE_USER_ID\": 2.5020%\n        }\n    ]\n}", "explain": "|id |select_type |table     |partitions|type |possible_keys                                            |key                         |key_len|ref  |rows|filtered|Extra                   |\n|---|------------|----------|----------|-----|---------------------------------------------------------|----------------------------|-------|-----|----|--------|------------------------|\n|1  |PRIMARY     |<derived2>|          |ALL  |                                                         |                            |       |     |70  |100     |                        |\n|2  |DERIVED     |pa1       |          |range|ix_hotel_price_adjustment_07                             |ix_hotel_price_adjustment_07|203    |     |41  |100     |Using where; Using index|\n|3  |UNION       |pa1       |          |ref  |ix_hotel_price_adjustment_04,ix_hotel_price_adjustment_08|ix_hotel_price_adjustment_08|67     |const|29  |100     |Using index             |\n|   |UNION RESULT|<union2,3>|          |ALL  |                                                         |                            |       |     |    |        |Using temporary         |", "expected": "当前查询性能满足要求，无需创建新索引"}
{"case_id": "6", "difficulty_level": "3","description": "业务case-关联列隐式转换测试（字符集）", "create_table_statements": "CREATE TABLE `inn_inns` (\n  `ID` varchar(64) NOT NULL COMMENT ' 酒店ID和第三方酒店ID',\n  `CHAIN_CODE` varchar(64) DEFAULT NULL COMMENT '用于兼容7天酒店ID,所以保留',\n  `S_CODE` varchar(32) DEFAULT NULL COMMENT '系统自维护酒店编码，格式：品牌编号+0000001，例如：7770000001(待定),通过编号表生成',\n  `BUSINESS_TYPE` tinyint(4) DEFAULT NULL COMMENT '[BUSSINIESS_TYPE] 0自营店，1管理店，2加盟店，3标准店  4合作店',\n  `OFFICE_CENTER_TYPE` tinyint(4) DEFAULT NULL,\n  `SUPPORT_PAYMENT_MODE` varchar(512) DEFAULT NULL,\n  `COMPANY_NAME` varchar(128) DEFAULT NULL COMMENT '针对合作酒店',\n  `FORENSIC_CODE` varchar(128) DEFAULT NULL,\n  `STATUS` tinyint(4) DEFAULT NULL COMMENT '0 营业中 1 停业 2 筹建',\n  `INN_TYPE` varchar(32) DEFAULT NULL COMMENT '[INN_TYPE] 100经济型酒店 101精品商务酒店 102景区度假酒店 103主题特色酒店 104民俗风情酒店 ',\n  `STAR_TYPE` tinyint(4) DEFAULT NULL COMMENT '[STAR_TYPE] 0 一星 1 二星 3 三星',\n  `RECOMMAND_STAR_TYPE` tinyint(4) DEFAULT NULL,\n  `MEDAL_TYPE` tinyint(4) DEFAULT NULL,\n  `START_FLOOR` varchar(32) DEFAULT NULL,\n  `END_FLOOR` varchar(32) DEFAULT NULL,\n  `TOTAL_ROOM` int(11) DEFAULT NULL,\n  `SYS_COUNTRY_ID` varchar(64) DEFAULT NULL,\n  `SYS_CITY_ID` varchar(64) DEFAULT NULL,\n  `SECOND_SYS_CITY_ID` varchar(64) DEFAULT NULL,\n  `SYS_DISTRICT_ID` varchar(64) DEFAULT NULL,\n  `SYS_BRAND_ID` varchar(64) DEFAULT NULL,\n  `HOTEL_MANAGE` varchar(256) DEFAULT NULL,\n  `INN_PHONE` varchar(128) DEFAULT NULL,\n  `INN_EMAIL` varchar(256) DEFAULT NULL,\n  `INN_FAX` varchar(128) DEFAULT NULL,\n  `SUPPORT_PAY_ONLINE` tinyint(4) DEFAULT NULL COMMENT '[YES_OR_NO] 1 是 0 否',\n  `PULL_ROOM_FLAG` tinyint(4) DEFAULT NULL COMMENT '是否拉取PMS房间信息[0 否  1是]',\n  `BOOK_FLAG` tinyint(4) DEFAULT '0' COMMENT '[YES_OR_NO] 1 是 0 否',\n  `SUPPORT_FOREIGN_GUEST` tinyint(4) DEFAULT NULL,\n  `VALUE_ADDED_INVOICE` tinyint(4) DEFAULT NULL,\n  `OPEN_DATE` date DEFAULT NULL,\n  `CLOSE_DATE` date DEFAULT NULL,\n  `IFSYNC` tinyint(4) DEFAULT '0' COMMENT '1不同步，其他同步',\n  `SALE_DEPART_ID` varchar(32) DEFAULT NULL,\n  `MAIN_PERSON` varchar(64) DEFAULT NULL,\n  `CHINESE_INFO_FULL` tinyint(4) DEFAULT '0',\n  `ENGLISH_INFO_FULL` tinyint(4) DEFAULT '0',\n  `AUDIT_STATUS` tinyint(4) DEFAULT '0',\n  `MAIN_PHONE` varchar(64) DEFAULT NULL,\n  `MAIN_EMAIL` varchar(255) DEFAULT NULL,\n  `DECORATION_DATE` varchar(64) CHARACTER SET utf8 DEFAULT NULL COMMENT '装修日期',\n  `ELEVATOR_NUM` int(11) DEFAULT NULL COMMENT '电梯数量',\n  `MEETING_ROOM_NUM` int(11) DEFAULT NULL COMMENT '会议室数量',\n  `MEETING_ROOM_ACCOMMODATES` int(11) DEFAULT NULL COMMENT '会议室可容纳人数',\n  `NON_SMOKING_ROOMS_NUM` int(11) DEFAULT NULL COMMENT '无烟房数量',\n  `MAX_CHECK_IN` int(11) DEFAULT NULL COMMENT '酒店最大入住人数',\n  `LAST_RETENTION_TIME` varchar(64) CHARACTER SET utf8 DEFAULT NULL COMMENT '酒店最晚保留时间(非担保)',\n  `SETTLEMENT_CURRENCY` varchar(64) CHARACTER SET utf8 DEFAULT NULL COMMENT '酒店结算货币',\n  `PANORAMA_IMAGE` varchar(512) CHARACTER SET utf8 DEFAULT NULL COMMENT '全景图地址',\n  `ZIP_CODE` varchar(64) CHARACTER SET utf8 DEFAULT NULL COMMENT '酒店邮编',\n  `CHECK_IN_TIME` varchar(64) CHARACTER SET utf8 DEFAULT NULL COMMENT '最早入住时间',\n  `CHECK_OUT_TIME` varchar(64) CHARACTER SET utf8 DEFAULT NULL COMMENT '最晚离店时间',\n  `TIME_ZONE` varchar(64) CHARACTER SET utf8 DEFAULT NULL COMMENT '时区',\n  `PETS` tinyint(4) DEFAULT '0' COMMENT '是否允许携带宠物 0 否  1是',\n  `ALLOW_MINORS` tinyint(4) DEFAULT '0' COMMENT '是否允许未成年人人单独入住 0 否  1是',\n  `INN_LEVEL` int(11) DEFAULT NULL COMMENT '酒店级别',\n  `VALID` tinyint(4) DEFAULT '1' COMMENT '[YES_OR_NO] 1 是 0 否',\n  `EXTEND` longtext,\n  `CREATE_DATE_TIME` datetime DEFAULT NULL,\n  `UPDATE_DATE_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `CHOOSE_ROOM_SWITCH` tinyint(4) DEFAULT '0' COMMENT '选房开关[0否 1是]',\n  `SMART_HOTEL` tinyint(4) DEFAULT '0' COMMENT '智能酒店标签 0 否 1是',\n  `BOOKING_INVOICE` tinyint(4) DEFAULT '0' COMMENT '预约发票 0关 1开',\n  `INVOICE_TYPE` varchar(64) DEFAULT '0' COMMENT '发票类型 0普通发票 1增值税普通发票 2增值税专用发票，可以多选，通过逗号分隔',\n  `HOME_LINK` varchar(256) DEFAULT NULL COMMENT '主页链接',\n  `SMOKING` varchar(32) DEFAULT '0',\n  `CRS_CODE` varchar(64) DEFAULT NULL COMMENT 'wehotel酒店编号在第三方酒店系统中的编号',\n  `PMS_CODE` varchar(64) DEFAULT NULL COMMENT 'JREZ系统中对接的PMS编码，仅供BI使用',\n  `ROOM_SWITCH_FLAG` tinyint(4) DEFAULT '0' COMMENT '选房开关标识 0自动 1手动',\n  `MORNING_ROOM` tinyint(4) DEFAULT '1' COMMENT '是否可预订凌晨房 0否 1是',\n  `SCAN_CHECK_IN` tinyint(4) DEFAULT '0' COMMENT '是否支持扫码入住 0 否 1是',\n  `IS_SUPPORT_GUIDE_DOG_POLICY` tinyint(4) DEFAULT '0' COMMENT '是否支持导盲犬政策[0 不支持，1 支持]',\n  `DIAMOND_RATING` tinyint(4) DEFAULT NULL COMMENT '准星级：0 无星 1 准一星；2 准二星；3 准三星；4 准四星；5 准五星',\n  `VIDEO_URL` varchar(256) DEFAULT NULL COMMENT '酒店介绍视频链接',\n  `IS_PRIVILEGE_MEMBER_HOTEL` tinyint(4) DEFAULT '0' COMMENT '是否尊享会会员酒店 0否 1是',\n  `REGIONAL_COMPANY` varchar(64) DEFAULT NULL COMMENT '区域公司',\n  `MANAGEMENT_COMPANY` varchar(64) DEFAULT NULL COMMENT '管理公司',\n  `IS_PERFECT_ENGLISH` tinyint(4) DEFAULT '0' COMMENT '是否完善英文要素：0 否 1 是',\n  `IS_BREAKFAST` tinyint(4) DEFAULT '0' COMMENT '是否提供早餐[0 否,1 是]',\n  `INN_INFO_INTEGRITY` varchar(64) DEFAULT NULL COMMENT '酒店信息完整度',\n  `IS_SESAME_CREDIT` tinyint(4) DEFAULT '0' COMMENT '是否支持芝麻信用支付[0 否，1 是] ',\n  `IS_DEPOSIT` tinyint(4) DEFAULT '0' COMMENT '是否收押金[0 否，1 是]',\n  `DEPOSIT_AMOUNT` varchar(64) DEFAULT '0' COMMENT '押金的金额',\n  `UPGRADE_TYPE` tinyint(4) DEFAULT '0' COMMENT '升级类型[0 无，1 新优品，2 新IU]',\n  `TRANSFER_PROJECT_ID` varchar(128) DEFAULT NULL COMMENT '关联项目编码（转品牌转前项目编码）',\n  `TRANSFER_INN_ID` varchar(128) DEFAULT NULL COMMENT '酒店编码（转品牌转前酒店编码）',\n  `TRANSFER_INN_NAME_CN` varchar(512) DEFAULT NULL COMMENT '酒店名称（转品牌转前酒店名称）',\n  `PROJECT_ID` varchar(128) DEFAULT NULL COMMENT '项目编码(铂涛酒店)',\n  `e_key` varchar(8) DEFAULT 'off' COMMENT '智能钥匙开关：on/off',\n  `IS_JIN_REWARDS` tinyint(4) DEFAULT '0' COMMENT '是否豪华经典酒店标识(原 锦好客酒店标识)[0 否；1 是]',\n  `PMS_PIPE` varchar(64) DEFAULT NULL COMMENT 'pms通道',\n  `PMS_FLAG` tinyint(4) DEFAULT NULL COMMENT '是否pms接口酒店',\n  `PMS_STATUS` tinyint(4) DEFAULT NULL COMMENT 'pms状态',\n  `PMS_VERSION` varchar(64) DEFAULT NULL COMMENT 'pms版本',\n  `CONTACT_NAME` varchar(64) DEFAULT '' COMMENT '联系人姓名',\n  `CONTACT_PHONE` varchar(64) DEFAULT '' COMMENT '联系人电话',\n  `ORG_ARCH_ID` varchar(64) DEFAULT '' COMMENT '公司区域标签(组织ID)',\n  `ONLINE_TIME` datetime DEFAULT NULL COMMENT '直连上线时间',\n  `DOWNLINE_TIME` datetime DEFAULT NULL COMMENT '直连下线时间',\n  `LOW_LIMIT` varchar(32) DEFAULT NULL COMMENT '最低价格，安全性保护，防止设置房价过低，而遭受损失',\n  `IS_CHINA_ZONE_HOTEL` tinyint(4) DEFAULT '0' COMMENT '是否中国区酒店标识[0 否；1 是]',\n  `POINT_CHARGING_MODE` tinyint(4) DEFAULT NULL COMMENT '积分收费模式[1=积分收费、2=以房抵费、0=无]',\n  `POINT_CHARGING_MODE_UPDATE_DATE` datetime DEFAULT NULL COMMENT '积分收费模式修改日期',\n  `POINT_CHARGING_MODE_VALID_DATE` datetime DEFAULT NULL COMMENT '积分收费模式生效日期 ',\n  `CHILD_FREE_AGE` varchar(32) DEFAULT NULL COMMENT '儿童免费年龄',\n  `HOTEL_THEME_TYPE` varchar(32) DEFAULT NULL COMMENT '酒店主题类型',\n  `MEETING_ROOM` tinyint(4) NOT NULL DEFAULT '0' COMMENT '是否有会议室  1-有  0-无',\n  PRIMARY KEY (`ID`),\n  KEY `idx_sys_brand_code` (`SYS_BRAND_ID`),\n  KEY `IX_inn_inns_SYS_COUNTRY_ID` (`SYS_COUNTRY_ID`,`STATUS`,`BOOK_FLAG`,`VALID`),\n  KEY `IX_inn_inns_SYS_CITY_ID` (`SYS_CITY_ID`,`STATUS`,`BOOK_FLAG`,`VALID`),\n  KEY `IX_inn_inns_SYS_DISTRICT_ID` (`SYS_DISTRICT_ID`,`STATUS`,`BOOK_FLAG`,`VALID`),\n  KEY `IX_inn_inns_SECOND_SYS_CITY_ID` (`SECOND_SYS_CITY_ID`,`STATUS`,`BOOK_FLAG`,`VALID`),\n  KEY `ix_inn_inns_1` (`STATUS`,`BOOK_FLAG`,`SYS_BRAND_ID`),\n  KEY `inn_inns_UPDATE_DATE_TIME_index` (`UPDATE_DATE_TIME`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4\n\nCREATE TABLE `inn_inns_language` (\n  `ID` varchar(64) NOT NULL,\n  `INN_ID` varchar(64) DEFAULT NULL,\n  `INN_NAME` varchar(512) DEFAULT NULL,\n  `INN_SHORT_NAME` varchar(512) DEFAULT NULL,\n  `INN_NAME_PINYIN` varchar(512) DEFAULT NULL COMMENT '用于列表搜索输入拼音',\n  `ADDRESS` text,\n  `LEGAL_ADDRESS` text,\n  `SHORT_DESCRIPTION` varchar(512) DEFAULT NULL,\n  `DESCRIPTION` longtext,\n  `DESCRIPTION_TEXT` longtext,\n  `SPECIAL_POLICY` longtext,\n  `SALUTATORY` longtext,\n  `EXTEND` longtext,\n  `LANG_TYPE` int(11) DEFAULT NULL COMMENT '[LANG_TYPE] 0 中文 1 英文 2 法文',\n  `REMARK` longtext,\n  `GUIDE` longtext COMMENT '到店指引',\n  `CREATE_DATE_TIME` datetime DEFAULT NULL,\n  `UPDATE_DATE_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  PRIMARY KEY (`ID`),\n  KEY `INDEX_INN_ID` (`INN_ID`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE `sys_brand` (\n  `ID` varchar(64) NOT NULL,\n  `BRAND_CODE` varchar(64) DEFAULT NULL,\n  `GROUP_ID` varchar(64) DEFAULT NULL,\n  `BRAND_TYPE` tinyint(4) DEFAULT NULL COMMENT '[BRAND_TYPE] 0 自有品牌 1 合作品牌',\n  `STAR_TYPE` tinyint(4) DEFAULT NULL,\n  `SORT` int(11) DEFAULT NULL,\n  `DESCRIPTION` longtext,\n  `DESCRIPTION_TEXT` longtext,\n  `CREATE_DATE_TIME` datetime DEFAULT NULL,\n  `UPDATE_DATE_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `BT_BRAND_CODE` varchar(64) DEFAULT NULL,\n  `CRS_BRAND_CODE` varchar(64) DEFAULT NULL COMMENT '第三方酒店品牌编号',\n  `BUSINESS_CATEGORY` tinyint(4) DEFAULT NULL COMMENT '业务类别：0酒店  1公寓  2咖啡',\n  `JREZ_BRAND_CODE` varchar(64) DEFAULT NULL COMMENT 'JREZ系统的品牌编号',\n  `EMAIL` varchar(128) DEFAULT NULL COMMENT '加盟邮箱',\n  `PHONE` varchar(128) DEFAULT NULL COMMENT '加盟热线',\n  `NAVIGATION_STATUS` tinyint(4) DEFAULT '0' COMMENT '导航状态 0关闭，1开启',\n  `BRAND_NAME_CN` varchar(128) DEFAULT NULL COMMENT '品牌名称，冗余字段，方便查询',\n  `BRAND_COLOR` varchar(64) DEFAULT NULL COMMENT '品牌馆皮肤色值',\n  `BRAND_SLOGAN` varchar(64) DEFAULT NULL COMMENT '品牌slogan',\n  `MOS_TYPE` tinyint(4) DEFAULT '0' COMMENT '品牌MOS归类 【0—A类；1—B类；2—C类；3—D类；4 —E类；5—F类；6—G类】',\n  `PARENT_CODE` varchar(64) DEFAULT '0' COMMENT '主品牌设置 【RHGB 丽笙；141 非繁；JJINN 锦江之星；wy2 维也纳酒店】',\n  PRIMARY KEY (`ID`),\n  KEY `sysBrandCode` (`BRAND_CODE`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4\n\nCREATE TABLE `sys_brand_language` (\n  `ID` varchar(64) NOT NULL,\n  `BRAND_ID` varchar(64) DEFAULT NULL,\n  `BRAND_NAME` varchar(256) DEFAULT NULL,\n  `LANG_TYPE` int(11) DEFAULT NULL COMMENT '[LANG_TYPE] 0 中文 1 英文 2 法文',\n  `CREATE_DATE_TIME` datetime DEFAULT NULL,\n  `UPDATE_DATE_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `BRAND_ADDRESS` varchar(256) DEFAULT NULL COMMENT '品牌的公司地址',\n  `BRAND_SPECIALITY` varchar(1000) DEFAULT NULL COMMENT '品牌特色',\n  `BRAND_STORY` varchar(2000) DEFAULT NULL COMMENT '品牌故事',\n  `BRAND_INTRODUCTION` varchar(256) DEFAULT NULL COMMENT '品牌信息介绍',\n  PRIMARY KEY (`ID`),\n  KEY `sbl_b1` (`BRAND_ID`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4\n\n\nCREATE TABLE `sys_group` (\n  `ID` varchar(64) NOT NULL,\n  `GROUP_NAME` varchar(128) DEFAULT NULL,\n  `GROUP_ADDRESS` varchar(512) DEFAULT NULL,\n  `TELEPHONE` varchar(128) DEFAULT NULL,\n  `CREATE_DATE_TIME` datetime DEFAULT NULL,\n  `UPDATE_DATE_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4\n\n\nCREATE TABLE `inn_china_org_region` (\n  `id` bigint(16) NOT NULL AUTO_INCREMENT COMMENT '主键',\n  `INN_ID` varchar(64) NOT NULL COMMENT '酒店ID',\n  `REGION_ID` int(11) DEFAULT NULL COMMENT '大区id,对应统一认证组织表的id字段',\n  `REGION_CODE` varchar(64) DEFAULT NULL COMMENT '大区code,对应应统一认证组织表的code字段',\n  `REGION_NAME` varchar(64) DEFAULT NULL COMMENT '大区名称,对应应统一认证组织表的name字段',\n  `PROVINCE_ID` int(11) DEFAULT NULL COMMENT '省区id,对应应统一认证组织表的id字段',\n  `PROVINCE_CODE` varchar(64) DEFAULT NULL COMMENT '省区code,对应应统一认证组织表的code字段',\n  `PROVINCE_NAME` varchar(64) DEFAULT NULL COMMENT '省区名称,对应应统一认证组织表的name字段',\n  `AREA_ID` int(11) DEFAULT NULL COMMENT '片区id,对应应统一认证组织表的id字段',\n  `AREA_CODE` varchar(64) DEFAULT NULL COMMENT '片区code,对应应统一认证组织表的code字段',\n  `AREA_NAME` varchar(64) DEFAULT NULL COMMENT '片区名称,对应应统一认证组织表的name字段',\n  `TYPE` tinyint(4) NOT NULL COMMENT '类型模式: 1,大区模式;2,独立品牌模式；当为大区模式时，AREA_*字段对应的是省区、PROVINCE_*字段对应的是总部、REGION_*字段对应的是总部、',\n  `STATUS` tinyint(4) DEFAULT NULL COMMENT '状态: 0,失效;1,有效',\n  `REMARK` varchar(2048) DEFAULT NULL COMMENT '备注',\n  `CREATE_USER_ID` int(11) DEFAULT NULL COMMENT '创建人ID',\n  `CREATE_DATE_TIME` datetime DEFAULT NULL COMMENT '创建日期时间',\n  `UPDATE_DATE_TIME` datetime DEFAULT NULL COMMENT '更新日期时间',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `INN_ID` (`INN_ID`),\n  KEY `ix_inn_china_org_region_1` (`REGION_ID`) USING BTREE,\n  KEY `ix_inn_china_org_region_2` (`PROVINCE_ID`) USING BTREE,\n  KEY `ix_inn_china_org_region_3` (`AREA_ID`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT COMMENT='酒店与中国区组织区域信息表'", "sql": "select\n ii.ID,\n iil.INN_NAME,\n ii.SYS_BRAND_ID,\n sbl.BRAND_NAME,\n sb.GROUP_ID,\n sg.GROUP_NAME,\n ii.CONTACT_NAME,\n ii.CONTACT_PHONE,\n ii.INN_FAX,\n ii.MANAGEMENT_COMPANY,\n ii.PMS_PIPE,\n ii.ORG_ARCH_ID,\n ii.IS_PRIVILEGE_MEMBER_HOTEL,\n ii.IS_JIN_REWARDS,\n ii.UPDATE_DATE_TIME,\n ico.REGION_ID,\n ico.REGION_NAME,\n ico.PROVINCE_ID,\n ico.PROVINCE_NAME,\n ico.AREA_ID,\n ico.AREA_NAME\nfrom inn_inns ii\n left join inn_inns_language iil on iil.inn_id = ii.id and iil.LANG_TYPE = 0\n left join sys_brand sb on sb.brand_code = ii.sys_brand_id\n LEFT JOIN sys_brand_language sbl ON sbl.BRAND_ID = sb.id  AND sbl.LANG_TYPE = 0\n left join sys_group sg on sg.id = sb.GROUP_ID\n LEFT JOIN inn_china_org_region ico ON ico.inn_id = ii.ID\nORDER BY ii.ID ASC\nlimit 0, 200", "columns_selectivity": "", "explain": "|id |select_type|table|partitions|type  |possible_keys|key         |key_len|ref                          |rows|filtered|Extra                                             |\n|---|-----------|-----|----------|------|-------------|------------|-------|-----------------------------|----|--------|--------------------------------------------------|\n|1  |SIMPLE     |ii   |          |ALL   |             |            |       |                             |1   |100     |Using temporary; Using filesort                   |\n|1  |SIMPLE     |iil  |          |ref   |INDEX_INN_ID |INDEX_INN_ID|259    |sqlflash_test.ii.ID          |1   |100     |Using where                                       |\n|1  |SIMPLE     |sb   |          |ref   |sysBrandCode |sysBrandCode|259    |sqlflash_test.ii.SYS_BRAND_ID|1   |100     |                                                  |\n|1  |SIMPLE     |sbl  |          |ref   |sbl_b1       |sbl_b1      |259    |sqlflash_test.sb.ID          |1   |100     |Using where                                       |\n|1  |SIMPLE     |sg   |          |eq_ref|PRIMARY      |PRIMARY     |258    |sqlflash_test.sb.GROUP_ID    |1   |100     |                                                  |\n|1  |SIMPLE     |ico  |          |ALL   |             |            |       |                             |1   |100     |Using where; Using join buffer (Block Nested Loop)|", "expected": "以下两种方式均可：\n1. 无法通过索引解决SQL性能问题。ii表与ico两表字符集不一致，建议将两表或其关联列的关联列修改为相同字符集\n2.SQL无性能问题"}
{"case_id": "7", "difficulty_level": "3","description": "业务case-缺失索引和索引列选择测试", "create_table_statements": "CREATE TABLE `batch` (\n  `id` BIGINT NOT NULL AUTO_INCREMENT,\n  `app_id` VARCHAR(50) NOT NULL,\n  `template` VARCHAR(255) DEFAULT NULL,\n  `param_array` TEXT,\n  `vendor` VARCHAR(100) DEFAULT NULL,\n  `render` VARCHAR(255) DEFAULT NULL,\n  `remark` TEXT,\n  `create_time` DATETIME NOT NULL,\n  `update_time` DATETIME DEFAULT NULL,\n  `quantity_note` VARCHAR(255) DEFAULT NULL,\n  `signature` VARCHAR(255) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;", "sql": "select\n  id,\n  app_id,\n  template,\n  param_array,\n  vendor,\n  render,\n  remark,\n  create_time,\n  update_time,\n  quantity_note,\n  signature\nfrom  batch\nWHERE \napp_id = 'ops_console' and\ncreate_time between '2025-09-01 00:00:00'  and '2025-09-01 23:59:59';", "columns_selectivity": "{\n            \"create_time\" : 95.9000%,\n            \"app_id\" : 0.0100%\n          }", "explain": "|id |select_type|table|partitions|type|possible_keys|key|key_len|ref|rows   |filtered|Extra      |\n|---|-----------|-----|----------|----|-------------|---|-------|---|-------|--------|-----------|\n|1  |SIMPLE     |batch|          |ALL |             |   |       |   |196,593|1.11    |Using where|", "expected": "以下两种情况均可：\n1. 在batch表的create_time列创建单列索引。\n2. 在batch表的app_id和create_time列创建符合索引，要求app_id列在前。"}
{"case_id": "8", "difficulty_level": "3","description": "业务case-测试模糊匹配-后模糊", "create_table_statements": "CREATE TABLE `benefit_acticvate_record` (\n  `ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  `jjid` bigint(20) NOT NULL DEFAULT '0' COMMENT '会员用户id',\n  `mebId` int(11) NOT NULL DEFAULT '0' COMMENT '会员ID',\n  `foreignKey` varchar(200) NOT NULL DEFAULT '0' COMMENT '外键',\n  `benefitId` int(11) NOT NULL DEFAULT '0' COMMENT '权益ID',\n  `appId` int(11) NOT NULL DEFAULT '0' COMMENT '应用appId',\n  `reqArgs` varchar(500) NOT NULL DEFAULT '0' COMMENT '请求外部权益参数，用于重试',\n  `coupon` varchar(300) DEFAULT NULL COMMENT '外部返回券码',\n  `msg` varchar(100) DEFAULT NULL COMMENT '外部接口返回信息',\n  `status` tinyint(4) DEFAULT '0' COMMENT '0:未处理或者失败;1:成功;2:明确失败(不重试);3:业务明确成功;4:异常退款;5:退款成功;6:退款失败;7:已使用',\n  `createTime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',\n  `lastModifyTime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录更改时间',\n  `reqNum` int(11) DEFAULT '0' COMMENT '请求次数',\n  `queryNum` int(11) DEFAULT '0' COMMENT '查询次数',\n  `orderNo` varchar(255) DEFAULT NULL COMMENT '外部权益服务订单号',\n  `mobile` varchar(25) DEFAULT NULL COMMENT '手机号',\n  `thirdOrderNo` varchar(30) DEFAULT NULL COMMENT '第三方订单号（海威版本加的）',\n  `url` varchar(700) DEFAULT NULL COMMENT '链接',\n  `notifyUrl` varchar(255) DEFAULT NULL COMMENT '回调通知地址',\n  `refundMsg` varchar(255) DEFAULT NULL COMMENT '退款返回信息',\n  `refundSuccessTime` datetime DEFAULT NULL COMMENT '退款成功时间',\n  PRIMARY KEY (`ID`),\n  KEY `record_mebId_index` (`mebId`),\n  KEY `record_foreignKey_index` (`foreignKey`),\n  KEY `create_time_index` (`createTime`),\n  KEY `index_status` (`status`) USING BTREE,\n  KEY `index_jjid` (`jjid`) USING BTREE,\n  KEY `index_benefitId_app_id` (`benefitId`,`appId`) USING BTREE,\n  KEY `ix_moblie` (`mobile`),\n  KEY `ix_thirdOrderNo` (`thirdOrderNo`)\n) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8 COMMENT='权益激活记录'", "sql": "SELECT\n  *\nFROM\n  `benefit_acticvate_record`\nWHERE\n  `reqArgs` LIKE 'Wehotel171450540847226847533%'\nLIMIT\n  0, 1000;", "columns_selectivity": "{\n    \"benefit_acticvate_record\": [\n        {\n            \"reqArgs\": 43.0000%\n        }\n    ]\n}", "explain": "{\n  \"ClassicResult\" : {\n    \"Columns\" : [ {\n      \"Name\" : \"id\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"select_type\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"table\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"partitions\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"type\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"possible_keys\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"key\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"key_len\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"ref\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"rows\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"filtered\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"Extra\",\n      \"I18nDesc\" : null\n    } ],\n    \"Rows\" : [ [ \"1\", \"SIMPLE\", \"benefit_acticvate_record\", \"\", \"ALL\", \"\", \"\", \"\", \"\", \"987588\", \"11.11\", \"Using where\" ]]\n  }\n}", "expected": "like后模糊可以走索引，在benefit_acticvate_record表的reqArgs列添加索引"}
{"case_id": "9", "difficulty_level": "3","description": "业务case-测试模糊匹配-前模糊", "create_table_statements": "CREATE TABLE `benefit_acticvate_record` (\n  `ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  `jjid` bigint(20) NOT NULL DEFAULT '0' COMMENT '会员用户id',\n  `mebId` int(11) NOT NULL DEFAULT '0' COMMENT '会员ID',\n  `foreignKey` varchar(200) NOT NULL DEFAULT '0' COMMENT '外键',\n  `benefitId` int(11) NOT NULL DEFAULT '0' COMMENT '权益ID',\n  `appId` int(11) NOT NULL DEFAULT '0' COMMENT '应用appId',\n  `reqArgs` varchar(500) NOT NULL DEFAULT '0' COMMENT '请求外部权益参数，用于重试',\n  `coupon` varchar(300) DEFAULT NULL COMMENT '外部返回券码',\n  `msg` varchar(100) DEFAULT NULL COMMENT '外部接口返回信息',\n  `status` tinyint(4) DEFAULT '0' COMMENT '0:未处理或者失败;1:成功;2:明确失败(不重试);3:业务明确成功;4:异常退款;5:退款成功;6:退款失败;7:已使用',\n  `createTime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',\n  `lastModifyTime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录更改时间',\n  `reqNum` int(11) DEFAULT '0' COMMENT '请求次数',\n  `queryNum` int(11) DEFAULT '0' COMMENT '查询次数',\n  `orderNo` varchar(255) DEFAULT NULL COMMENT '外部权益服务订单号',\n  `mobile` varchar(25) DEFAULT NULL COMMENT '手机号',\n  `thirdOrderNo` varchar(30) DEFAULT NULL COMMENT '第三方订单号（海威版本加的）',\n  `url` varchar(700) DEFAULT NULL COMMENT '链接',\n  `notifyUrl` varchar(255) DEFAULT NULL COMMENT '回调通知地址',\n  `refundMsg` varchar(255) DEFAULT NULL COMMENT '退款返回信息',\n  `refundSuccessTime` datetime DEFAULT NULL COMMENT '退款成功时间',\n  PRIMARY KEY (`ID`),\n  KEY `record_mebId_index` (`mebId`),\n  KEY `record_foreignKey_index` (`foreignKey`),\n  KEY `create_time_index` (`createTime`),\n  KEY `index_status` (`status`) USING BTREE,\n  KEY `index_jjid` (`jjid`) USING BTREE,\n  KEY `index_benefitId_app_id` (`benefitId`,`appId`) USING BTREE,\n  KEY `ix_moblie` (`mobile`),\n  KEY `ix_thirdOrderNo` (`thirdOrderNo`)\n) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8 COMMENT='权益激活记录'", "sql": "SELECT\n  *\nFROM\n  `benefit_acticvate_record`\nWHERE\n  `reqArgs` LIKE '%Wehotel171450540847226847533'\nLIMIT\n  0, 1000;", "columns_selectivity": "{\n    \"benefit_acticvate_record\": [\n        {\n            \"reqArgs\": 43.0000%\n        }\n    ]\n}", "explain": "{\n  \"ClassicResult\" : {\n    \"Columns\" : [ {\n      \"Name\" : \"id\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"select_type\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"table\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"partitions\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"type\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"possible_keys\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"key\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"key_len\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"ref\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"rows\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"filtered\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"Extra\",\n      \"I18nDesc\" : null\n    } ],\n    \"Rows\" : [ [ \"1\", \"SIMPLE\", \"benefit_acticvate_record\", \"\", \"ALL\", \"\", \"\", \"\", \"\", \"987588\", \"11.11\", \"Using where\" ]]\n  }\n}", "expected": "like前模糊无法走索引，无法通过索引解决SQL性能问题，可以考虑全文索引"}
{"case_id": "10","difficulty_level": "3", "description": "业务case-测试模糊匹配-前后模糊", "create_table_statements": "CREATE TABLE `benefit_acticvate_record` (\n  `ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  `jjid` bigint(20) NOT NULL DEFAULT '0' COMMENT '会员用户id',\n  `mebId` int(11) NOT NULL DEFAULT '0' COMMENT '会员ID',\n  `foreignKey` varchar(200) NOT NULL DEFAULT '0' COMMENT '外键',\n  `benefitId` int(11) NOT NULL DEFAULT '0' COMMENT '权益ID',\n  `appId` int(11) NOT NULL DEFAULT '0' COMMENT '应用appId',\n  `reqArgs` varchar(500) NOT NULL DEFAULT '0' COMMENT '请求外部权益参数，用于重试',\n  `coupon` varchar(300) DEFAULT NULL COMMENT '外部返回券码',\n  `msg` varchar(100) DEFAULT NULL COMMENT '外部接口返回信息',\n  `status` tinyint(4) DEFAULT '0' COMMENT '0:未处理或者失败;1:成功;2:明确失败(不重试);3:业务明确成功;4:异常退款;5:退款成功;6:退款失败;7:已使用',\n  `createTime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',\n  `lastModifyTime` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录更改时间',\n  `reqNum` int(11) DEFAULT '0' COMMENT '请求次数',\n  `queryNum` int(11) DEFAULT '0' COMMENT '查询次数',\n  `orderNo` varchar(255) DEFAULT NULL COMMENT '外部权益服务订单号',\n  `mobile` varchar(25) DEFAULT NULL COMMENT '手机号',\n  `thirdOrderNo` varchar(30) DEFAULT NULL COMMENT '第三方订单号（海威版本加的）',\n  `url` varchar(700) DEFAULT NULL COMMENT '链接',\n  `notifyUrl` varchar(255) DEFAULT NULL COMMENT '回调通知地址',\n  `refundMsg` varchar(255) DEFAULT NULL COMMENT '退款返回信息',\n  `refundSuccessTime` datetime DEFAULT NULL COMMENT '退款成功时间',\n  PRIMARY KEY (`ID`),\n  KEY `record_mebId_index` (`mebId`),\n  KEY `record_foreignKey_index` (`foreignKey`),\n  KEY `create_time_index` (`createTime`),\n  KEY `index_status` (`status`) USING BTREE,\n  KEY `index_jjid` (`jjid`) USING BTREE,\n  KEY `index_benefitId_app_id` (`benefitId`,`appId`) USING BTREE,\n  KEY `ix_moblie` (`mobile`),\n  KEY `ix_thirdOrderNo` (`thirdOrderNo`)\n) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8 COMMENT='权益激活记录'", "sql": "SELECT\n  *\nFROM\n  `benefit_acticvate_record`\nWHERE\n  `reqArgs` LIKE '%Wehotel171450540847226847533%'\nLIMIT\n  0, 1000;", "columns_selectivity": "{\n    \"benefit_acticvate_record\": [\n        {\n            \"reqArgs\": 43.0000%\n        }\n    ]\n}", "explain": "{\n  \"ClassicResult\" : {\n    \"Columns\" : [ {\n      \"Name\" : \"id\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"select_type\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"table\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"partitions\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"type\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"possible_keys\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"key\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"key_len\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"ref\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"rows\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"filtered\",\n      \"I18nDesc\" : null\n    }, {\n      \"Name\" : \"Extra\",\n      \"I18nDesc\" : null\n    } ],\n    \"Rows\" : [ [ \"1\", \"SIMPLE\", \"benefit_acticvate_record\", \"\", \"ALL\", \"\", \"\", \"\", \"\", \"987588\", \"11.11\", \"Using where\" ]]\n  }\n}", "expected": "like前后模糊无法走索引，无法通过索引解决SQL性能问题，可以考虑全文索引"}
{"case_id": "11","difficulty_level": "3", "description": "业务case-测试OR", "create_table_statements": "CREATE TABLE `document` (\n  `id` bigint(20) NOT NULL COMMENT '文档ID',\n  `title` varchar(500) DEFAULT NULL COMMENT '文档名称',\n  `pdfKey` varchar(100) DEFAULT NULL COMMENT '转换为pdf后的文件标识',\n  `type` varchar(15) NOT NULL COMMENT '文档来源类型',\n  `pages` int(5) DEFAULT NULL COMMENT '总页数',\n  `sizes` int(11) DEFAULT NULL COMMENT '文件大小',\n  `businessId` bigint(20) DEFAULT NULL COMMENT '关联的业务ID，如合同ID',\n  `createTime` datetime NOT NULL COMMENT '创建时间',\n  `pixelWidth` double DEFAULT NULL COMMENT '页宽',\n  `pixelHeight` double DEFAULT NULL COMMENT '页高',\n  `fileKey` varchar(100) DEFAULT NULL COMMENT '原文件标识',\n  `origin` bigint(20) DEFAULT NULL COMMENT '原文件ID',\n  `documentType` varchar(10) NOT NULL DEFAULT 'UPLOAD' COMMENT '文档类型',\n  `antifakeCode` varchar(10) DEFAULT NULL COMMENT '防伪码',\n  `usages` varchar(20) DEFAULT 'NORMAL' COMMENT '文件用途（NORMAL合同正文,SPONSOR_FILE发起方内部可见文档,TERMINATION作废声明,OFFLINE线下签署文件,ATTACHMENT附件EVIDENCE存证报告）',\n  `htmlKey` varchar(100) DEFAULT NULL COMMENT 'HTML模板文件',\n  `documentSort` int(11) DEFAULT NULL COMMENT '前端页面文档的排列顺序',\n  `convertStrategy` varchar(20) DEFAULT NULL COMMENT '文件转换策略',\n  `needUpdatePdf` tinyint(1) DEFAULT '0' COMMENT '是否需要更新PDF',\n  `modifyHtml` tinyint(1) DEFAULT NULL COMMENT '是否允许HTML原文修改 ',\n  `status` varchar(20) DEFAULT NULL COMMENT '文档状态',\n  `creatorId` bigint(20) DEFAULT NULL COMMENT '创建者id',\n  `signatoryId` bigint(20) DEFAULT NULL COMMENT '用于接收方上传附件,附件和签署方绑定',\n  `signed` tinyint(1) DEFAULT NULL COMMENT '附件是否被签署',\n  `headKey` varchar(50) DEFAULT NULL COMMENT 'HTML模版页眉文件',\n  `footKey` varchar(50) DEFAULT NULL COMMENT 'HTML模版页脚文件',\n  `backupKey` varchar(100) DEFAULT NULL COMMENT '备份文件标识',\n  `attachId` bigint(20) DEFAULT NULL COMMENT '附件规则id',\n  `fileHash` varchar(256) DEFAULT NULL,\n  `originType` varchar(20) DEFAULT NULL COMMENT '文件原类型',\n  `openDiyTitle` tinyint(4) DEFAULT NULL COMMENT '接口传递自定义标题',\n  `noCertSign` tinyint(1) DEFAULT NULL COMMENT '是否无证书签署',\n  `noCertDocId` bigint(20) DEFAULT NULL COMMENT '隐藏参数文档id',\n  `operatorType` varchar(50) DEFAULT NULL COMMENT '隐藏参数的角色类型',\n  `hideParamNames` varchar(500) DEFAULT NULL COMMENT '隐藏参数的名称',\n  `readOnlyDocumentId` bigint(20) DEFAULT NULL COMMENT '隐藏非只读参数文档id',\n  `jsonKey` varchar(100) DEFAULT NULL COMMENT 'json在文件服务器标识',\n  `transientDocumentId` varchar(1024) DEFAULT NULL COMMENT 'Adobe文件id',\n  `adobeDocumentId` varchar(256) DEFAULT NULL COMMENT 'Adobe文件库id',\n  `mergeDocId` bigint(20) DEFAULT NULL COMMENT '合并后的文档ID',\n  `atomizationDocId` bigint(20) DEFAULT NULL COMMENT '雾化文档id',\n  `titleRule` varchar(500) DEFAULT NULL COMMENT '标题规则',\n  `titleRuleType` tinyint(1) DEFAULT NULL COMMENT '标题规则类型',\n  `oldTitle` varchar(500) DEFAULT NULL COMMENT '旧标题，非模板命名规则文档使用',\n  `appId` bigint(20) DEFAULT NULL COMMENT '应用ID，即AppToken.id',\n  `ownerPassword` varchar(20) DEFAULT NULL COMMENT '编辑密码',\n  PRIMARY KEY (`id`) USING BTREE,\n  KEY `IDX_DOC_PDFKEY` (`pdfKey`) USING BTREE,\n  KEY `IDX_DOCUMENT_BUSINESS` (`businessId`) USING BTREE,\n  KEY `IDX_ORIGIN` (`origin`),\n  KEY `IDX_DOCUMENT_SIGNID` (`signatoryId`),\n  KEY `IDX_NOCERTDOCID_READONLYDOCUMENTID` (`noCertDocId`,`readOnlyDocumentId`),\n  KEY `IDX_MERGEDOCID` (`mergeDocId`),\n  KEY `IDX_DOC_FILEKEY` (`fileKey`),\n  KEY `ix_02` (`businessId`,`createTime`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文档信息表'", "sql": "SELECT\n  *\nfrom\n  DOCUMENT\nwhere\n  (\n    pdfKey = '20241230-65c295d4-825a-48b6-9153-f479eea2e01c05-ne'\n    or fileKey = '20241230-65c295d4-825a-48b6-9153-f479eea2e01c05-ne'\n  );", "columns_selectivity": "", "explain": "{\n        \"explain SELECT \\r\\n  * \\r\\nfrom \\r\\n  DOCUMENT \\r\\nwhere \\r\\n  (\\r\\n    pdfKey = '20241230-65c295d4-825a-48b6-9153-f479eea2e01c05-ne' \\r\\n    or fileKey = '20241230-65c295d4-825a-48b6-9153-f479eea2e01c05-ne'\\r\\n  )\": [\n         {\n          \"id\" : 1,\n          \"select_type\" : \"SIMPLE\",\n          \"table\" : \"DOCUMENT\",\n          \"partitions\" : null,\n          \"type\" : \"index_merge\",\n          \"possible_keys\" : \"IDX_DOC_PDFKEY,IDX_DOC_FILEKEY\",\n          \"key\" : \"IDX_DOC_PDFKEY,IDX_DOC_FILEKEY\",\n          \"key_len\" : \"403,403\",\n          \"ref\" : null,\n          \"rows\" : 2,\n          \"filtered\" : 100.0,\n          \"Extra\" : \"Using union(IDX_DOC_PDFKEY,IDX_DOC_FILEKEY); Using where\"\n         }\n        ]}", "expected": "使用了index merge 当前查询性能满足要求，无需创建新索引"}
{"case_id": "12","difficulty_level": "1", "description": "单表等值简单查询-简单等值条件查询，单列索引和避免重复索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users WHERE username = 'user_98000';", "columns_selectivity": "{\"users\":{\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |         10 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "给 users 表的 username 列加索引"}
{"case_id": "13","difficulty_level": "1", "description": "单表等值简单查询-简单等值条件查询，单列索引和避免重复索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users WHERE email = 'user_1193@test.com';", "columns_selectivity": "{\"users\":{\"email\":100%}}", "explain": "|id |select_type|table|partitions|type |possible_keys|key  |key_len|ref  |rows|filtered|Extra|\n|---|-----------|-----|----------|-----|-------------|-----|-------|-----|----|--------|-----|\n|1  |SIMPLE     |users|          |const|email        |email|803    |const|1   |100     |     |", "expected": "users 表的 email 列已有唯一索引，对于该查询无需创建新的索引"}
{"case_id": "14","difficulty_level": "1", "description": "单表等值简单查询-索引长度不合理", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0,\n  KEY `idx_username` (`username`(2))\n);", "sql": "SELECT * FROM users WHERE username = 'user_98000';", "columns_selectivity": "{\"users\":{\"username\":100%}}", "explain": "|id |select_type|table|partitions|type|possible_keys|key      |key_len|ref  |rows  |filtered|Extra      |\n|---|-----------|-----|----------|----|-------------|---------|-------|-----|------|--------|-----------|\n|1  |SIMPLE     |users|          |ref |idx_users    |idx_users|10     |const|49,791|100     |Using where|", "expected": "idx_username索引长度太短，导致扫描行数过多，需要重建idx_username索引，删除原有users表idx_username索引并在username列添加默认长度的索引"}
{"case_id": "15","difficulty_level": "1", "description": "单表，范围查询-BETWEEN...AND...范围列可以加索引", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT * FROM orders WHERE pay_time \nBETWEEN '2025-08-01 00:00:00' AND '2025-8-31 23:59:59' limit 10;", "columns_selectivity": "{\"orders\":{\"pay_time\":35.23%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | orders  | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |      11.11 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "给 orders 表的 pay_time 列加索引"}
{"case_id": "16","difficulty_level": "1", "description": "单表，范围查询->=、<= 列加索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users WHERE points >= 1000 AND points <= 2000  limit 10;", "columns_selectivity": "{\"users\":{\"points\":19.882%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |      11.11 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "给 users 表的 points 列加索引"}
{"case_id": "17","difficulty_level": "1", "description": "单表，范围查询->=、<= 列加索引", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT user_id, ip_address, response_time_ms FROM access_logs WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY);", "columns_selectivity": "{\"access_logs\":{\"created_at\":0.038%,\"ip_address\":69.552%,\"response_time_ms\":6%,\"user_id\":78.36%}}", "explain": "+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-------------+\n|   id | select_type   | table       | partitions   | type   | possible_keys   | key   | key_len   | ref   |    rows |   filtered | Extra       |\n+======+===============+=============+==============+========+=================+=======+===========+=======+=========+============+=============+\n|    1 | SIMPLE        | access_logs | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |      33.33 | Using where |\n+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-------------+", "expected": "以下两种情况均可：\n给 access_logs 表的 created_at 列创建单列索引\n给 access_logs 表的 created_at, user_id, ip_address, response_time_ms列创建覆盖索引，且顺序要created_at为最左列"}
{"case_id": "18","difficulty_level": "1", "description": "单表，简单分组、排序查询-给分组/排序列加索引，以消除文件排序", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT * FROM access_logs ORDER BY created_at DESC LIMIT 1000;", "columns_selectivity": "{\"access_logs\":{\"created_at\":1.3960%}}", "explain": "+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+----------------+\n|   id | select_type   | table       | partitions   | type   | possible_keys   | key   | key_len   | ref   |    rows |   filtered | Extra          |\n+======+===============+=============+==============+========+=================+=======+===========+=======+=========+============+================+\n|    1 | SIMPLE        | access_logs | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |        100 | Using filesort |\n+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+----------------+", "expected": "给 access_logs 表的 created_at 列加索引，消除文件排序"}
{"case_id": "19","difficulty_level": "1", "description": "单表，简单分组、排序查询-给分组/排序列加索引，以消除文件排序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT gender, COUNT(*) AS user_count FROM users GROUP BY gender;", "columns_selectivity": "{\"users\":{\"gender\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+---------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                           |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=================================+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |        100 | Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+---------------------------------+", "expected": "给 users 表的 gender 列加索引，消除临时表和文件排序"}
{"case_id": "20","difficulty_level": "1", "description": "单表，简单分组、排序查询-给分组/排序列加索引，以消除文件排序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT register_channel, COUNT(*) AS user_count\nFROM users\nGROUP BY register_channel;", "columns_selectivity": "{\"users\":{\"register_channel\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+---------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                           |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=================================+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |        100 | Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+---------------------------------+", "expected": "给 users 表的 register_channel 列加索引，消除临时表和文件排序"}
{"case_id": "21","difficulty_level": "1", "description": "单表，or 条件-无法通过索引解决性能场景，OR 条件导致索引失效", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users \nWHERE gender = 1 OR register_channel = 'Web';", "columns_selectivity": "{\"users\":{\"gender\":0.006%,\"register_channel\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |         19 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下两种情况均可:\n1. 无法通过索引解决SQL性能问题，OR条件列通常无法充分利用索引\n2. 分别给users表的register_channel，gender列添加单列索引，优化器可能会利用index merge合并索引"}
{"case_id": "22","difficulty_level": "1", "description": "单表，or 条件-无法通过索引解决性能场景，OR 条件导致索引失效", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users \nWHERE vip_level = 3 OR last_login < '2023-01-01';", "columns_selectivity": "{\"users\":{\"last_login\":35.294%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |         40 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下两种情况均可:\n1. 无法通过索引解决SQL性能问题，OR条件列通常无法充分利用索引\n2. 分别给users表的vip_level，last_login列添加单列索引，优化器可能会利用index merge合并索引\n3. 给users表的last_login列添加单列索引"}
{"case_id": "23","difficulty_level": "1", "description": "单表，or 条件-无法通过索引解决性能场景，OR 条件导致索引失效", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT * FROM products \nWHERE stock > 100 OR weight < 1.0;", "columns_selectivity": "{\"products\":{\"stock\":10%,\"weight\":5.01%}}", "explain": "+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table    | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+==========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | products | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   9836 |      55.55 | Using where |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下两种情况均可：\n1. 不能通过索引解决SQL中存在性能问题\n2. 分别给products表的stock和weight创建单列索引"}
{"case_id": "24","difficulty_level": "1", "description": "单表，or 条件-无法通过索引解决性能场景，OR 条件导致索引失效", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT * FROM products WHERE price > 500 AND price < 1000 OR weight > 5.0;", "columns_selectivity": "{\"products\":{\"price\":97.37%,\"weight\":5.01%}}", "explain": "+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table    | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+==========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | products | NULL         | ALL    | idx_p           | NULL  | NULL      | NULL  |   9836 |      40.74 | Using where |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下两种情况均可：\n1. 不能通过索引解决SQL中存在性能问题\n2. 列分给products表的price列和weight列创建单列索引"}
{"case_id": "25","difficulty_level": "2", "description": "单表，多条件查询-复合索引中列的顺序，要求从左到右等值列在前，范围列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * \nFROM users \nWHERE gender = 1 \n  AND birthdate BETWEEN '1990-01-01' AND '2000-12-31';", "columns_selectivity": "{\"users\":{\"birthdate\":19.876%,\"gender\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |       1.11 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下两种情况均可：\n1. 在 users 表的 gender 列和 birthdate 创建复合索引，注意 gender 列一定在最左边\n2. 在 users 表的 birthdate 创建单列索引"}
{"case_id": "26","difficulty_level": "2", "description": "单表，多条件查询-复合索引中列的顺序，要求从左到右等值列在前，范围列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT * \nFROM products \nWHERE category_id = 5 \n  AND is_imported = 1 \n  AND stock < 10;", "columns_selectivity": "{\"products\":{\"category_id\":0.2%,\"is_imported\":0.02%,\"stock\":10%}}", "explain": "+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table    | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+==========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | products | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   9836 |       0.33 | Using where |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下三种情况均可：\n1. 在 products 表的 category_id 列和 is_imported 列和 stock 列创建复合索引，注意列顺序依次为 category_id，is_imported，stock\n2. 在products表的stock列创建单列索引\n3.表数据量较小，无性能问题"}
{"case_id": "27","difficulty_level": "2", "description": "单表，多条件查询-复合索引中列的顺序，要求从左到右等值列在前，范围列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT * \nFROM orders \nWHERE pay_time BETWEEN '2025-08-10' AND '2025-09-20'\n  AND amount > 1000 \n  AND currency = 'CNY';", "columns_selectivity": "{\"orders\":{\"pay_time\":35.2300%,\"amount\":94.2960%,\"currency\":0.0020%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | orders  | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |       0.37 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "两种方式均可：\n1. 在orders表的pay_time,currency列创建复合索引，且要求pay_time在最左列\n2.在orders表的pay_time,amount列创建复合索引，且要求列顺序为：pay_time，amount"}
{"case_id": "28","difficulty_level": "2", "description": "单表，多条件查询-复合索引中列的顺序，要求从左到右等值列在前，范围列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT * \nFROM products \nWHERE stock > 100 \n  AND weight < 5.0 \n  AND is_imported = 1;", "columns_selectivity": "{\"products\":{\"is_imported\":0.02%,\"stock\":10%,\"weight\":5.01%}}", "explain": "+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table    | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+==========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | products | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   9836 |       1.11 | Using where |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "三种情况均可：\n1. 在 products 表的 is_imported 列和 weight 列创建复合索引，注意 is_imported 一定在最左边\n2. 在 products 表的 is_imported 列和 stock 列创建复合索引，注意 is_imported 一定在最左边\n3. 分别给products表的stock和weight列创建单列索引"}
{"case_id": "29","difficulty_level": "2", "description": "单表，多条件查询-复合索引中列的顺序，要求从左到右等值列在前，范围列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT * FROM orders WHERE amount > 1000 and user_id = '15946' and ship_country = 'China' and delivery_company = 'UPS'", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"delivery_company\":0.008%,\"ship_country\":0.01%,\"user_id\":77.982%}}", "explain": "|id |select_type|table |partitions|type|possible_keys|key|key_len|ref|rows   |filtered|Extra      |\n|---|-----------|------|----------|----|-------------|---|-------|---|-------|--------|-----------|\n|1  |SIMPLE     |orders|          |ALL |             |   |       |   |497,080|0.03    |Using where|", "expected": "以下三种情况均可:\n1. 在 orders 表的 user_id、ship_country、delivery_company列创建复合索引，注意列顺序从左到右必须为user_id、ship_country/delivery_company。\n2. 在 orders 表的 user_id、ship_country、delivery_company、amount列创建复合索引，注意列顺序从左到右必须为user_id、ship_country、delivery_company、amount。\n3. 无法通过索引解决SQL性能问题，存在隐式转换。"}
{"case_id": "30","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT * \nFROM access_logs \nWHERE ip_address = '192.168.1.100' \n  AND response_time_ms > 500 \nORDER BY created_at DESC;", "columns_selectivity": "{\"access_logs\":{\"ip_address\":69.552%,\"response_time_ms\":6%}}", "explain": "+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-----------------------------+\n|   id | select_type   | table       | partitions   | type   | possible_keys   | key   | key_len   | ref   |    rows |   filtered | Extra                       |\n+======+===============+=============+==============+========+=================+=======+===========+=======+=========+============+=============================+\n|    1 | SIMPLE        | access_logs | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |       3.33 | Using where; Using filesort |\n+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-----------------------------+", "expected": "以下两种情况均可：\n1. 在 access_logs 表的ip_address, response_time_ms, created_at列创建复合索引，要求ip_address为左列\n2.在 access_logs 表的 ip_address 列和 created_at 列创建复合索引，要求ip_address为左列"}
{"case_id": "31","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT * \nFROM orders \nWHERE user_id = 12345 \nORDER BY pay_time DESC \nLIMIT 1;", "columns_selectivity": "{\"orders\":{\"user_id\":77.982%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============================+\n|    1 | SIMPLE        | orders  | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |         10 | Using where; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+", "expected": "在 orders 表的 user_id 列和 pay_time 创建复合索引，注意 user_id 列一定在最左边"}
{"case_id": "32","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users\nWHERE register_channel = 'Web' AND gender = 1\nORDER BY last_login DESC;", "columns_selectivity": "{\"users\":{\"gender\":0.006%,\"register_channel\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============================+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |          1 | Using where; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+", "expected": "在 users 表的 register_channel 列和 gender 列和 last_login 列创建复合索引，注意 last_login 列一定在最右边"}
{"case_id": "33","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT * FROM orders\nWHERE amount > 1000 AND ship_country = 'China'\nORDER BY pay_time ASC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"ship_country\":0.01%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============================+\n|    1 | SIMPLE        | orders  | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |       3.33 | Using where; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+", "expected": "以下三种情况均可：\n1. 在orders表的ship_country, amount, pay_time列加复合索引，ship_country为左列\n2. 在orders表的ship_country,pay_time列加复合索引，ship_country为左列\n3. 在orders表的amount, ship_country, pay_time列加复合索引"}
{"case_id": "34","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users\nWHERE vip_level >= 3 AND points > 1000\nORDER BY birthdate ASC;", "columns_selectivity": "{\"users\":{\"points\":19.882%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============================+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |      11.11 | Using where; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-----------------------------+", "expected": "以下两种情况均可：\n1. 在users表的 points, vip_level列创建复合索引。\n2. 在users表的 birthdate 列添加索引，消除文件排序。"}
{"case_id": "35","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT \n    register_channel, \n    COUNT(*) AS user_count, \n    AVG(points) AS avg_points\nFROM \n    users\nWHERE \n    gender = 1 \n    AND birthdate BETWEEN '1990-01-01' AND '2000-12-31'\n    AND vip_level > 0\nGROUP BY \n    register_channel\nORDER BY \n    user_count DESC;", "columns_selectivity": "{\"users\":{\"birthdate\":19.876%,\"gender\":0.006%,\"points\":19.882%,\"register_channel\":0.006%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                                        |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+==============================================+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |       0.37 | Using where; Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+", "expected": "以下三种情况均可：\n1. 在 users 表的 gender, birthdate, vip_level或register_channel列上创建复合索引，列顺序为：gender, birthdate, vip_level或register_channel（gender, birthdate位置可互换）\n2. 在 users 表的 gender, birthdate, vip_level, register_channel, points 列创建覆盖索引，顺序要求前三列为gender, birthdate, vip_level（gender, birthdate位置可互换）\n3. 在users表的birthdate列创建单列索引"}
{"case_id": "36","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT \n    ship_country, \n    ship_city, \n    COUNT(*) AS order_count, \n    SUM(amount) AS total_amount\nFROM \n    orders\nWHERE \n    currency = 'CNY' \n    AND pay_time BETWEEN '2025-08-10' AND '2025-09-20'\n    AND amount > 1000\nGROUP BY \n    ship_country, ship_city\nORDER BY \n    total_amount DESC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"currency\":0.002%,\"pay_time\":35.23%,\"ship_city\":0.01%,\"ship_country\":0.01%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                                        |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+==============================================+\n|    1 | SIMPLE        | orders  | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |       0.37 | Using where; Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+", "expected": "在orders表的pay_time,currency,amount,ship_city,ship_country列创建覆盖索引，要求pay_time,currency,amount谓词列为左列，无顺序要求"}
{"case_id": "37","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT \n    brand, \n    origin_country, \n    COUNT(*) AS product_count, \n    AVG(price) AS avg_price\nFROM \n    products\nWHERE \n    is_imported = 1 \n    AND stock > 0 \n    AND weight < 5\nGROUP BY \n    brand, origin_country\nORDER BY \n    product_count DESC;", "columns_selectivity": "{\"products\":{\"brand\":0.05%,\"is_imported\":0.02%,\"origin_country\":0.06%,\"price\":97.37%,\"stock\":10%,\"weight\":5.01%}}", "explain": "+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+\n|   id | select_type   | table    | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                                        |\n+======+===============+==========+==============+========+=================+=======+===========+=======+========+============+==============================================+\n|    1 | SIMPLE        | products | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   9836 |       1.11 | Using where; Using temporary; Using filesort |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+", "expected": "以下三种情况均可\n1. 谓词列选择性太低，不适合建索引，无法通过索引解决SQL性能问题\n2. 为 products 表的 is_imported列、stock或weight列添加复合索引stock或weight只能存在一列\n3. 创建覆盖索引，包含列is_imported, brand, origin_country, stock, weight, price，要求is_imported为最左列"}
{"case_id": "38","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    ip_address, \n    COUNT(*) AS request_count, \n    AVG(response_time_ms) AS avg_response_time\nFROM \n    access_logs\nWHERE \n    http_method = 'GET' \n    AND response_code = 200 \n    AND created_at BETWEEN '2025-09-19 15:50:02' AND '2025-09-19 15:52:02'\nGROUP BY \n    ip_address\nORDER BY \n    request_count DESC;", "columns_selectivity": "{\"access_logs\":{\"created_at\":0.038%,\"http_method\":0.008%,\"ip_address\":69.552%,\"response_code\":0.006%,\"response_time_ms\":6%}}", "explain": "+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+----------------------------------------------+\n|   id | select_type   | table       | partitions   | type   | possible_keys   | key   | key_len   | ref   |    rows |   filtered | Extra                                        |\n+======+===============+=============+==============+========+=================+=======+===========+=======+=========+============+==============================================+\n|    1 | SIMPLE        | access_logs | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |       0.11 | Using where; Using temporary; Using filesort |\n+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+----------------------------------------------+", "expected": "以下两种情况均可：\n1. 在 access_logs 表的 created_at 列创建索引\n2. 在 access_logs 表的 created_at、http_method、response_code、ip_address、response_time_ms 列创建覆盖索引"}
{"case_id": "39","difficulty_level": "3", "description": "单表，多条件 + 排序分组查询-复合索引中列的顺序，要求从左到右等值列在前，范围列或分组/排序列在后，等值列按列选择性由高到底排序，并且范围列仅能有一列", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT \n    YEAR(birthdate) AS birth_year, \n    gender, \n    COUNT(*) AS user_count, \n    MAX(points) AS max_points\nFROM \n    users\nWHERE \n    (phone IS NOT NULL OR email LIKE '%@gmail.com') \n    AND last_login > '2023-01-01' \n    AND points > 100\nGROUP BY \n    birth_year, gender\nORDER BY \n    birth_year ASC, gender ASC;", "columns_selectivity": "{\"users\":{\"birthdate\":19.876%,\"email\":100%,\"gender\":0.006%,\"last_login\":35.294%,\"phone\":99.912%,\"points\":19.882%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                                        |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+==============================================+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |      10.12 | Using where; Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------+", "expected": "以下两种情况均可：\n1. 无法通过索引解决SQL性能问题\n2. 在users表的phone,email,last_login,points,birthdate,gender列创建覆盖索引，要求phone,email,last_login,points列为左列，无顺序要求。"}
{"case_id": "40","difficulty_level": "2", "description": "单表，覆盖索引-是否适合创建覆盖索引判断", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT user_id, username, email, phone\nFROM users\nWHERE gender = 1 \n  AND birthdate > '1990-01-01' \n  AND vip_level >= 2;", "columns_selectivity": "{\"users\":{\"birthdate\":19.876%,\"email\":100%,\"gender\":0.006%,\"phone\":99.912%,\"user_id\":100%,\"username\":100%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |       1.11 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下三种情况均可：\n1. 无法通过索引解决SQL性能问题。\n2. 由于查询SQL中涉及的列数过多，不建议创建覆盖索引，建议在 users 表的gender，birthdate，vip_level列创建复合索引，列顺序为：gender，vip_level，birthdate。\n3. 在 users 表的birthdate列创建单列索引"}
{"case_id": "41","difficulty_level": "2", "description": "单表，覆盖索引-是否适合创建覆盖索引判断", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT order_id, order_sn, amount, pay_time\nFROM orders\nWHERE user_id = 12345 \n  AND currency = 'CNY' \n  AND pay_time IS NOT NULL;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"currency\":0.002%,\"order_id\":100%,\"order_sn\":100%,\"pay_time\":35.23%,\"user_id\":77.982%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | orders  | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |        0.9 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下三种情况均可：\n1. 在orders表上创建覆盖索引，包含的列有：user_id，currency，pay_time, order_sn, amount，要求user_id，currency，pay_time为左列\n2. 在orders表上创建复合索引，包含的字段和顺序为：user_id，pay_time\n3. 在orders表上创建复合索引，包含的字段和顺序为：user_id，pay_time，pay_time"}
{"case_id": "42","difficulty_level": "2", "description": "单表，覆盖索引-是否适合创建覆盖索引判断", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT product_id, product_name, price\nFROM products\nWHERE is_imported = 1 \n  AND stock > 0;", "columns_selectivity": "{\"products\":{\"is_imported\":0.02%,\"price\":97.37%,\"product_id\":100%,\"product_name\":100%,\"stock\":10%}}", "explain": "+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table    | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+==========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | products | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   9836 |       3.33 | Using where |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "以下三种情况均可：\n1. 无法通过索引解决SQL性能问题，由于where条件中列选择性太低，不适合建索引的查询\n2. 为该查询创建覆盖索引，在products表的is_imported，stock，product_name，price列创建复合索引，注意is_imported为最左列，stock为左侧第二列\n3. 在products表的istock列创建索引"}
{"case_id": "43","difficulty_level": "2", "description": "单表，覆盖索引-是否适合创建覆盖索引判断", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT log_id, request_url, response_code, response_time_ms\nFROM access_logs\nWHERE user_id = 67890 \n  AND http_method = 'GET' \n  AND response_code = 200 \n  AND created_at > '2023-01-01';", "columns_selectivity": "{\"access_logs\":{\"created_at\":0.038%,\"http_method\":0.008%,\"log_id\":100%,\"request_url\":2%,\"response_code\":0.006%,\"response_time_ms\":6%,\"user_id\":78.36%}}", "explain": "+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-------------+\n|   id | select_type   | table       | partitions   | type   | possible_keys   | key   | key_len   | ref   |    rows |   filtered | Extra       |\n+======+===============+=============+==============+========+=================+=======+===========+=======+=========+============+=============+\n|    1 | SIMPLE        | access_logs | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |       0.03 | Using where |\n+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-------------+", "expected": "以下两种情况均可：\n1. 由于查询SQL中涉及的列数过多，不建议创建覆盖索引，在access_logs表上创建联合索引，包含的字段和顺序为：user_id，created_at。\n2. 由于查询SQL中涉及的列数过多，不建议创建覆盖索引，在access_logs表的user_id, response_code, http_method, created_at列上创建联合索引，要求user_id在最左列，created_at在最右列。\n3. 在access_logs表的user_id列创建单列索引"}
{"case_id": "44","difficulty_level": "2", "description": "单表，like-Like 前模糊和前后模糊查询会导致索引失效，后模糊可以走索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users WHERE username LIKE 'John%';", "columns_selectivity": "{\"users\":{\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |      11.11 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "模糊查询后模糊匹配会走索引，可在 users 表的 username 列创建索引"}
{"case_id": "45","difficulty_level": "2", "description": "单表，like-Like 前模糊和前后模糊查询会导致索引失效，后模糊可以走索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users WHERE username LIKE '%smh';", "columns_selectivity": "{\"users\":{\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |      11.11 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "like前模糊无法利用索引，无法通过索引优化解决SQL的性能问题，可以考虑用全文索引"}
{"case_id": "46","difficulty_level": "2", "description": "单表，like-Like 前模糊和前后模糊查询会导致索引失效，后模糊可以走索引", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT * FROM access_logs WHERE request_url LIKE '%login%';", "columns_selectivity": "{\"access_logs\":{\"request_url\":2%}}", "explain": "+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-------------+\n|   id | select_type   | table       | partitions   | type   | possible_keys   | key   | key_len   | ref   |    rows |   filtered | Extra       |\n+======+===============+=============+==============+========+=================+=======+===========+=======+=========+============+=============+\n|    1 | SIMPLE        | access_logs | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |      11.11 | Using where |\n+------+---------------+-------------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-------------+", "expected": "like前后模糊无法利用索引，无法通过索引优化解决SQL的性能问题，可以考虑使用全文索引"}
{"case_id": "47","difficulty_level": "2", "description": "单表，不适合建索引-NOT IN 列索引多数情况不生效", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT * FROM orders \nWHERE ship_country NOT IN ('China', 'USA');", "columns_selectivity": "{\"orders\":{\"ship_country\":0.01%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | orders  | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |         80 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "对于NOT IN查询，常规索引可能效果极其有限，不建议通过索引优化"}
{"case_id": "48","difficulty_level": "2", "description": "单表，不适合建索引-NOT IN 列索引多数情况不生效", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users \nWHERE gender NOT IN (1, 2) \n  AND birthdate BETWEEN '1990-01-01' AND '2000-12-31' Limit 10;", "columns_selectivity": "{\"users\":{\"birthdate\":19.876%,\"gender\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |       8.89 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "在users表的 birthdate 列添加索引"}
{"case_id": "49","difficulty_level": "2", "description": "单表，不适合建索引-NOT IN 可以建索引的情况（覆盖索引）", "create_table_statements": "CREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT ship_country FROM orders \nWHERE ship_country NOT IN ('China', 'USA');", "columns_selectivity": "{\"orders\":{\"ship_country\":0.01%}}", "explain": "|id |select_type|table |partitions|type|possible_keys|key|key_len|ref|rows   |filtered|Extra      |\n|---|-----------|------|----------|----|-------------|---|-------|---|-------|--------|-----------|\n|1  |SIMPLE     |orders|          |ALL |             |   |       |   |497,513|80      |Using where|", "expected": "以下两种情况均可\n1. 在 orders 表的 ship_country 添加索引\n2. 无法通过索引解决SQL性能问题"}
{"case_id": "50","difficulty_level": "2", "description": "单表，不适合建索引-<> 列索引多数情况不生效", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users WHERE gender <> 1;", "columns_selectivity": "{\"users\":{\"gender\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |         90 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "不等于操作符的条件列会导致索引失效，进行全表扫描，不建议通过索引优化"}
{"case_id": "51","difficulty_level": "2", "description": "单表， IS NULL 条件-IS NULL列可以使用索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT user_id, username, email\nFROM users\nWHERE phone IS NULL;", "columns_selectivity": "{\"users\":{\"email\":100%,\"phone\":99.912%,\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | SIMPLE        | users   | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |         10 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "IS NULL列可以使用索引，在users表的phone列加索引"}
{"case_id": "52","difficulty_level": "3", "description": "多表关联的多条件查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.username, \n    u.email, \n    o.order_sn, \n    o.amount, \n    o.pay_time, \n    p.product_name, \n    p.price\nFROM \n    users u\nJOIN \n    orders o ON u.user_id = o.user_id\nJOIN \n    products p ON o.order_id = p.product_id\nWHERE \n    u.user_id = 12345\n    AND o.pay_time BETWEEN '2025-08-10' AND '2025-09-20'\n    AND p.category_id = 5;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_sn\":100%,\"pay_time\":35.23%},\"products\":{\"category_id\":0.2%,\"price\":97.37%,\"product_name\":100%},\"users\":{\"email\":100%,\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                     |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=========+===========+=========================+========+============+=============+\n|    1 | SIMPLE        | u       | NULL         | const  | PRIMARY         | PRIMARY | 8         | const                   |      1 |        100 | NULL        |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+-------------+\n|    1 | SIMPLE        | p       | NULL         | ALL    | PRIMARY         | NULL    | NULL      | NULL                    |   9836 |         10 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+-------------+\n|    1 | SIMPLE        | o       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.p.product_id |      1 |          5 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+-------------+", "expected": "以下两种情况均可：\n情况1：\n1. 在products表的category_id列创建单列索引\n2. 在orders表的user_id、pay_time列创建复合索引，注意user_id需要在最左边\n情况2：\n创建覆盖索引：\n1. orders 表的user_id, pay_time, order_sn, amount列创建覆盖索引,要求user_id 在最左列。\n2. products表的category_id, product_id, product_name, price创建覆盖索引，要求category_id为最左列"}
{"case_id": "53","difficulty_level": "3", "description": "多表关联的多条件查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.username, \n    u.vip_level, \n    a.request_url, \n    a.http_method, \n    a.response_code, \n    a.created_at\nFROM \n    users u\nJOIN \n    access_logs a ON u.user_id = a.user_id\nWHERE \n    u.vip_level > 0\n    AND a.created_at BETWEEN '2025-09-19 15:50:02' AND '2025-09-19 15:52:02'\n    AND a.response_code = 200;", "columns_selectivity": "{\"access_logs\":{\"created_at\":0.038%,\"http_method\":0.008%,\"request_url\":2%,\"response_code\":0.006%},\"users\":{\"username\":100%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |    rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=========+===========+======================+=========+============+=============+\n|    1 | SIMPLE        | a       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 1987219 |       1.11 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+-------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.a.user_id |       1 |      33.33 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+-------------+", "expected": "以下两种情况均可：\n1. 给 access_logs 表的 created_at 列创建索引。\n2. 给 access_logs 表的 user_id、response_code、created_at、vip_level创建索引，要求vip_level为最右列。"}
{"case_id": "54","difficulty_level": "3", "description": "多表关联的多条件查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.username, \n    u.phone, \n    o.order_sn, \n    o.amount, \n    o.ship_country, \n    o.ship_city, \n    o.delivery_company\nFROM \n    users u\nJOIN \n    orders o ON u.user_id = o.user_id\nWHERE \n    o.ship_country = 'USA'\n    AND o.pay_time IS NOT NULL\n    AND u.gender = 1;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"delivery_company\":0.008%,\"order_sn\":100%,\"pay_time\":35.23%,\"ship_city\":0.01%,\"ship_country\":0.01%},\"users\":{\"gender\":0.006%,\"phone\":99.912%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+-------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra       |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+=============+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |          9 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+-------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |         10 | Using where |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+-------------+", "expected": "以下两种情况均可：\n1. 在orders表的ship_country、user_id，pay_time列创建复合索引，且顺序为user_id,ship_country,pay_time（受pay_time is not null数据的占比数影响，pay_time不固定）\n2. 在orders表的ship_country, pay_time,user_id列创建联合索引,顺序要求要求同。"}
{"case_id": "55","difficulty_level": "3", "description": "多表关联的多条件查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.username, \n    a.request_url, \n    a.response_time_ms, \n    o.order_sn, \n    o.amount\nFROM \n    users u\nJOIN \n    access_logs a ON u.user_id = a.user_id\nLEFT JOIN \n    orders o ON u.user_id = o.user_id\nWHERE \n    a.created_at BETWEEN '2025-09-19 15:50:02' AND '2025-09-19 15:52:02'\n    AND a.response_time_ms > 500\n    AND o.pay_time IS NOT NULL;", "columns_selectivity": "{\"access_logs\":{\"created_at\":0.038%,\"request_url\":2%,\"response_time_ms\":6%},\"orders\":{\"amount\":94.296%,\"order_sn\":100%,\"pay_time\":35.23%},\"users\":{\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |    rows |   filtered | Extra                                              |\n+======+===============+=========+==============+========+=================+=========+===========+======================+=========+============+====================================================+\n|    1 | SIMPLE        | a       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 1987219 |        3.7 | Using where                                        |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.a.user_id |       1 |      100   | NULL                                               |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 |  497490 |        9   | Using where; Using join buffer (Block Nested Loop) |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+", "expected": "以下两种情况均可：\n1. 在 access_logs 表的 created_at 列创建索引，并且在 orders 的user_id列创建索引。\n2. 在 access_logs 表的 created_at, response_time_ms列创建复合索引，并且在 orders 的 user_id, pay_time列创建符合索引"}
{"case_id": "56","difficulty_level": "3", "description": "多表关联的多条件分组排序查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id,\n    u.username,\n    COUNT(o.order_id) AS order_count,\n    SUM(o.amount) AS total_amount\nFROM \n    users u\nJOIN \n    orders o ON u.user_id = o.user_id\nWHERE \n    u.vip_level > 0\n    AND o.pay_time BETWEEN '2025-08-10' AND '2025-08-11'\nGROUP BY \n    u.user_id, u.username\nORDER BY \n    total_amount DESC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"pay_time\":35.23%},\"users\":{\"user_id\":100%,\"username\":100%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra                                        |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+==============================================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |      11.11 | Using where; Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------------------------------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |      33.33 | Using where                                  |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------------------------------------+", "expected": "在orders表的pay_time,user_id,amount列创建复合索引，并要求pay_time在最左列"}
{"case_id": "57","difficulty_level": "3", "description": "多表关联的多条件分组排序查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    o.ship_country,\n    COUNT(o.order_id) AS order_count,\n    SUM(o.amount) AS total_amount\nFROM \n    orders o\nJOIN \n    users u ON o.user_id = u.user_id\nWHERE \n    u.gender = 1\n    AND o.currency = 'CNY'\nGROUP BY \n    o.ship_country\nORDER BY \n    order_count DESC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"currency\":0.002%,\"order_id\":100%,\"ship_country\":0.01%},\"users\":{\"gender\":0.006%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra                                        |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+==============================================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |         10 | Using where; Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------------------------------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |         10 | Using where                                  |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------------------------------------+", "expected": "三种情况均可：\n1. 在orders表的currency，user_id列创建复合索引，要求currency在最左列，并且在users表的currency列创建索引。\n2. 在orders表的 currency 列创建索引。\n3. 在orders表的currency, user_id, ship_country, amount列创建复合索引currency, user_id为最左列，并在users表的gender列创建索引"}
{"case_id": "58","difficulty_level": "3", "description": "多表关联的多条件分组排序查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id, \n    u.username, \n    u.email, \n    o.order_id, \n    o.order_sn, \n    o.amount, \n    o.pay_time\nFROM \n    users u\nLEFT JOIN \n    orders o ON u.user_id = o.user_id\nWHERE \n    u.vip_level > 0\nORDER BY \n    u.register_channel DESC, \n    u.user_id DESC\nLIMIT 100;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"order_sn\":100%,\"pay_time\":35.23%},\"users\":{\"email\":100%,\"user_id\":100%,\"username\":100%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                                              |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+====================================================+\n|    1 | SIMPLE        | u       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |      33.33 | Using where; Using temporary; Using filesort       |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |     100    | Using where; Using join buffer (Block Nested Loop) |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------------+", "expected": "在orders表的user_id列添加索引用以加速关联，并且在users表的register_channel列创建索引用以消除文件排序"}
{"case_id": "59","difficulty_level": "3", "description": "多表关联的多条件分组排序查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT o.order_id, o.order_sn, o.amount, o.pay_time, o.ship_city\n     FROM orders o\n     JOIN users u ON o.user_id = u.user_id\n     WHERE u.email = 'user_18@test.com'\n     ORDER BY o.amount DESC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"order_sn\":100%,\"pay_time\":35.23%,\"ship_city\":0.01%},\"users\":{\"email\":100%}}", "explain": "|id |select_type|table|partitions|type |possible_keys|key  |key_len|ref  |rows   |filtered|Extra                      |\n|---|-----------|-----|----------|-----|-------------|-----|-------|-----|-------|--------|---------------------------|\n|1  |SIMPLE     |u    |          |const|PRIMARY,email|email|803    |const|1      |100     |Using index; Using filesort|\n|1  |SIMPLE     |o    |          |ALL  |             |     |       |     |497,837|10      |Using where                |", "expected": "以下两种情况均可：\n1. 在orders表的user_id，amount列建立复合索引，注意user_id必须在最左边\n2. 在orders表的user_id, amount, order_sn, pay_time, ship_city列创建覆盖索引，要求user_id，amount为左列"}
{"case_id": "60","difficulty_level": "3", "description": "多表关联的多条件分组排序查询，驱动表识别以及复合索引列顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT u.user_id, u.username, SUM(o.amount) AS total_amount\n     FROM users u\n     JOIN orders o ON u.user_id = o.user_id\n     WHERE u.last_login >= DATE_SUB(NOW(), INTERVAL 2 MONTH)\n       AND u.vip_level >= 3\n     GROUP BY u.user_id, u.username;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%},\"users\":{\"last_login\":35.294%,\"user_id\":100%,\"username\":100%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+---------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra                           |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+=================================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |     100    | Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+---------------------------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |      11.11 | Using where                     |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+---------------------------------+", "expected": "必须：在orders表的user_id列加单列索引或者user_id, amount加符合索引，user_id在最左列\n可选：在users表的last_login，vip_level或者last_login,vip_level,  username列建立覆盖索引，注意last_login列要求在最左列"}
{"case_id": "61","difficulty_level": "3", "description": "多表，group by 不同表-关联查询中GROUP BY相同表的多列需要按字段顺序创建复合索引解决临时表和文件排序问题", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id, \n    u.username, \n    SUM(o.amount) AS total_amount\nFROM \n    users u\nJOIN \n    orders o ON u.user_id = o.user_id\nGROUP BY \n    u.user_id, u.username;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%},\"users\":{\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+---------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra                           |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+=================================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |        100 | Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+---------------------------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |        100 | NULL                            |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+---------------------------------+", "expected": "以下两种情况均可：\n1. 在orders表的 user_id 列上创建索引，并且在users表的 user_id,username 列创建复合索引，user_id列必须在最左列\n2. 在orders表的 user_id，amount列创建复合索引，要求user_id为左列"}
{"case_id": "62","difficulty_level": "3", "description": "多表，group by 不同表-关联查询中GROUP BY不同表的列无法解决临时表和文件排序问题", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id, \n    u.username, \n    u.email, \n    o.order_id, \n    o.amount, \n    o.pay_time\nFROM \n    users u\nLEFT JOIN \n    orders o ON u.user_id = o.user_id\nORDER BY \n    u.register_channel, \n    o.pay_time DESC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"pay_time\":35.23%},\"users\":{\"email\":100%,\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra                                              |\n+======+===============+=========+==============+========+=================+=======+===========+=======+========+============+====================================================+\n|    1 | SIMPLE        | u       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |        100 | Using temporary; Using filesort                    |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |        100 | Using where; Using join buffer (Block Nested Loop) |\n+------+---------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+----------------------------------------------------+", "expected": "在orders表的 user_id 列添加索引"}
{"case_id": "63","difficulty_level": "3", "description": "多表，相同表多字段排序-关联表查询ORDER BY 相同表多字段，解决文件排序问题，包括需要将主键加入复合索引的场景", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    o.order_id, \n    o.amount, \n    o.ship_country, \n    o.ship_city, \n    u.user_id, \n    u.username\nFROM \n    orders o\nLEFT JOIN \n    users u ON o.user_id = u.user_id\nORDER BY \n    o.order_id ASC, \n    o.ship_city ASC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"ship_city\":0.01%,\"ship_country\":0.01%},\"users\":{\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra          |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |        100 | Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |        100 | NULL           |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+", "expected": "两种情况均可\n1. 无法通过索引解决SQL性能问题\n2. 在orders表的order_id、ship_city列创建复合索引，要求order_id为左列"}
{"case_id": "64","difficulty_level": "3", "description": "多表，相同表多字段排序-关联表查询ORDER BY 相同表多字段，解决文件排序问题，包括需要将主键加入复合索引的场景", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    o.order_id, \n    o.amount, \n    o.ship_country, \n    o.ship_city, \n    u.user_id, \n    u.username\nFROM \n    orders o\nLEFT JOIN \n    users u ON o.user_id = u.user_id\nORDER BY \n    o.ship_country ASC, \n    o.ship_city ASC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"ship_city\":0.01%,\"ship_country\":0.01%},\"users\":{\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra          |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |        100 | Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |        100 | NULL           |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+", "expected": "两种情况均可\n1. 无法通过索引解决SQL性能问题\n2. 在orders表的ship_country、ship_city列创建复合索引，要求ship_country为左列"}
{"case_id": "65","difficulty_level": "3", "description": "多表，相同表多字段排序-当INNER JOIN时，在数据量较大的驱动表上创建索引（可以转换驱动表与被驱动表，从而减少扫描行数）", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    o.order_id, \n    o.amount, \n    o.ship_country, \n    o.ship_city, \n    u.user_id, \n    u.username\nFROM \n    orders o\nINNER JOIN \n    users u ON o.user_id = u.user_id\nORDER BY \n    o.ship_country ASC, \n    o.ship_city ASC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"ship_city\":0.01%,\"ship_country\":0.01%},\"users\":{\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |   rows |   filtered | Extra          |\n+======+===============+=========+==============+========+=================+=========+===========+======================+========+============+================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 497490 |        100 | Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |      1 |        100 | NULL           |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+--------+------------+----------------+", "expected": "两种情况均可：\n1. 在orders表的user_id列创建索引\n2. 在orders表的user_id,ship_country,ship_city列创建复合索引，要求列顺序为：user_id,ship_country,ship_city"}
{"case_id": "66","difficulty_level": "3", "description": "表关联，复杂场景-关联查询的复合索引中关联列、条件列和排序/分组列的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.username, \n    o.order_sn, \n    o.amount, \n    o.pay_time, \n    p.product_name, \n    p.price, \n    p.brand\nFROM \n    users u\nJOIN \n    orders o ON u.user_id = o.user_id\nJOIN \n    products p ON o.order_id = p.product_id\nWHERE \n    u.user_id = 12272\nORDER BY \n    o.pay_time DESC;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_sn\":100%,\"pay_time\":35.23%},\"products\":{\"brand\":0.05%,\"price\":97.37%,\"product_name\":100%},\"users\":{\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+---------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                     |   rows |   filtered | Extra                           |\n+======+===============+=========+==============+========+=================+=========+===========+=========================+========+============+=================================+\n|    1 | SIMPLE        | u       | NULL         | const  | PRIMARY         | PRIMARY | 8         | const                   |      1 |        100 | Using temporary; Using filesort |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+---------------------------------+\n|    1 | SIMPLE        | p       | NULL         | ALL    | PRIMARY         | NULL    | NULL      | NULL                    |   9836 |        100 | NULL                            |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+---------------------------------+\n|    1 | SIMPLE        | o       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.p.product_id |      1 |         10 | Using where                     |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+-------------------------+--------+------------+---------------------------------+", "expected": "以下两种情况均可：\n1. 在orders表的user_id,pay_time列添加复合索引，user_id列必须在左边\n2. 无性能问题，不需要创建索引"}
{"case_id": "67","difficulty_level": "3", "description": "表关联，复杂场景-关联查询的复合索引中关联列、条件列和排序/分组列的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id,\n    u.username,\n    u.vip_level,\n    o.order_sn,\n    o.pay_time,\n    al.request_url,\n    al.created_at AS access_time\nFROM \n    users u\nJOIN \n    orders o ON u.user_id = o.user_id\nJOIN \n    access_logs al ON u.user_id = al.user_id\nWHERE \n    u.vip_level > 0\nORDER BY \n    u.user_id, al.created_at DESC;", "columns_selectivity": "{\"access_logs\":{\"created_at\":0.038%,\"request_url\":2%},\"orders\":{\"order_sn\":100%,\"pay_time\":35.23%},\"users\":{\"user_id\":100%,\"username\":100%,\"vip_level\":0.012%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |    rows |   filtered | Extra                                              |\n+======+===============+=========+==============+========+=================+=========+===========+======================+=========+============+====================================================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 |  497490 |     100    | Using temporary; Using filesort                    |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |       1 |      33.33 | Using where                                        |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | al      | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 1987219 |      10    | Using where; Using join buffer (Block Nested Loop) |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+", "expected": "两种情况均可：\n1. 分别在orders表的user_id列和access_logs表的user_id列添加索引。\n2. 在access_logs表的user_id列添加索引。"}
{"case_id": "68","difficulty_level": "3", "description": "表关联，复杂场景-关联查询的复合索引中关联列、条件列和排序/分组列的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id, \n    u.username, \n    a.request_url, \n    a.response_code, \n    o.order_id, \n    o.amount, \n    o.pay_time\nFROM \n    users u\nJOIN \n    access_logs a ON u.user_id = a.user_id\nJOIN \n    orders o ON u.user_id = o.user_id\nWHERE \n    a.request_url LIKE '%/resource%'\n    AND o.amount > 500\nORDER BY \n    o.pay_time DESC;", "columns_selectivity": "{\"access_logs\":{\"request_url\":2%,\"response_code\":0.006%},\"orders\":{\"amount\":94.296%,\"order_id\":100%,\"pay_time\":35.23%},\"users\":{\"user_id\":100%,\"username\":100%}}", "explain": "+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|   id | select_type   | table   | partitions   | type   | possible_keys   | key     | key_len   | ref                  |    rows |   filtered | Extra                                              |\n+======+===============+=========+==============+========+=================+=========+===========+======================+=========+============+====================================================+\n|    1 | SIMPLE        | o       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 |  497490 |      33.33 | Using where; Using temporary; Using filesort       |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | u       | NULL         | eq_ref | PRIMARY         | PRIMARY | 8         | test_index.o.user_id |       1 |     100    | NULL                                               |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+\n|    1 | SIMPLE        | a       | NULL         | ALL    | NULL            | NULL    | NULL      | NULL                 | 1987219 |       1.11 | Using where; Using join buffer (Block Nested Loop) |\n+------+---------------+---------+--------------+--------+-----------------+---------+-----------+----------------------+---------+------------+----------------------------------------------------+", "expected": "在orders表的amount,pay_time,user_id列创建覆盖索引，且列顺序为(amount,pay_time,user_id)或(user_id,pay_time,amount)，并在access_logs表的user_id或user_id, request_url, response_code列创建索引"}
{"case_id": "69","difficulty_level": "3", "description": "关联子查询-子查询索引创建，条件列和查询列在覆盖索引中的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id, \n    u.username, \n    (SELECT MAX(created_at) \n     FROM access_logs \n     WHERE user_id = u.user_id) AS last_login_time\nFROM \n    users u\nWHERE \n    u.vip_level > 0;", "columns_selectivity": "{\"users\":{\"user_id\":100%,\"username\":100%},\"access_logs\":{\"user_id\":5.0460%,\"created_at\":1.3960%},}", "explain": "以下两种情况均可：\n1. 无法通过索引解决SQL性能问题，response_code 列选择性过低或存在隐式类型转换。\n2. 给access_logs表的response_code加索引。\n（隐式类型转换导致索引失效的前提是在索引列上进行转换，默认情况下MySQL的转换规则是将字符串转为数字，所以response_code的索引是有效的）", "expected": "必须：在access_logs表的(user_id)或(user_id、created_at)列创建索引\n可选：在users表的(vip_level)或(username,vip_level)列创建索引，要求vip_level为左列"}
{"case_id": "70","difficulty_level": "3", "description": "关联子查询-子查询索引创建，条件列和查询列在覆盖索引中的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id, \n    u.username, \n    (SELECT AVG(o.amount) \n     FROM orders o \n     WHERE o.user_id = u.user_id) AS avg_amount,\n    (SELECT MAX(o.pay_time) \n     FROM orders o \n     WHERE o.user_id = u.user_id) AS last_order_time\nFROM \n    users u\nWHERE \n    u.gender = 1;", "columns_selectivity": "{\"users\":{\"user_id\":100%,\"username\":100%,\"gender\":0.0060%},\"orders\":{\"user_id\":77.9820%,\"amount\":94.2960%,\"pay_time\":35.2300%}}", "explain": "+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type        | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+====================+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | PRIMARY            | u       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |         10 | Using where |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|    3 | DEPENDENT SUBQUERY | o       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |         10 | Using where |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|    2 | DEPENDENT SUBQUERY | o       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |         10 | Using where |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "必须：在orders表的user_id或user_id, amount（也可包含pay_time）列创建索引\n可选：在users表的gender列（可包含username列）创建合索引，要求gender为左列"}
{"case_id": "71","difficulty_level": "3", "description": "关联子查询-子查询索引创建，条件列和查询列在覆盖索引中的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    u.user_id, \n    u.username, \n    (SELECT COUNT(*) \n     FROM access_logs a \n     WHERE a.user_id = u.user_id) AS log_count,\n    (SELECT a.request_url \n     FROM access_logs a \n     WHERE a.user_id = u.user_id \n     ORDER BY a.created_at DESC \n     LIMIT 1) AS last_visited_url\nFROM \n    users u\nWHERE \n    u.points > 500;", "columns_selectivity": "{\"users\":{\"user_id\":100%,\"username\":100%,\"points\":19.8820%},\"access_logs\":{\"user_id\":78.3600%,\"request_url\":2.0000%,\"created_at\":0.0380%},}", "explain": "+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-----------------------------+\n|   id | select_type        | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |    rows |   filtered | Extra                       |\n+======+====================+=========+==============+========+=================+=======+===========+=======+=========+============+=============================+\n|    1 | PRIMARY            | u       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   99553 |      33.33 | Using where                 |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-----------------------------+\n|    3 | DEPENDENT SUBQUERY | a       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |      10    | Using where; Using filesort |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-----------------------------+\n|    2 | DEPENDENT SUBQUERY | a       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 1987219 |      10    | Using where                 |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+---------+------------+-----------------------------+", "expected": "必须：在access_logs表的user_id列创建索引或user_id和created_at列创建复合索引\n可选：在users表的points,username列创建复合索引，要求points在左边"}
{"case_id": "72","difficulty_level": "3", "description": "关联子查询-子查询索引创建，条件列和查询列在覆盖索引中的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n    p.product_id, \n    p.product_name, \n    p.stock\nFROM \n    products p\nWHERE \n    p.is_imported = 1 \n    AND p.stock > (\n        SELECT AVG(stock) \n        FROM products \n        WHERE is_imported = 1\n    );", "columns_selectivity": "{\"products\":{\"is_imported\":0.02%,\"product_id\":100%,\"product_name\":100%,\"stock\":10%}}", "explain": "+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type   | table    | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+===============+==========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | PRIMARY       | p        | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   9836 |       3.33 | Using where |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|    2 | SUBQUERY      | products | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |   9836 |      10    | Using where |\n+------+---------------+----------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "三种情况均可：\n1. 所涉及到的列选择性过低，无法通过索引解决SQL性能问题\n2. 为此查询创建覆盖索引，在products表的is_imported,stock,product_name列创建复合索引，列顺序为is_imported,stock,product_name\n3. 为此查询创建覆盖索引，在products表的is_imported,stock列创建复合索引，列顺序为is_imported,stock"}
{"case_id": "73","difficulty_level": "3", "description": "关联子查询-子查询索引创建，条件列和查询列在覆盖索引中的顺序", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);\nCREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);\nCREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT u.user_id, u.username, u.email\nFROM users u\nWHERE EXISTS (\n    SELECT 1\n    FROM orders o\n    WHERE o.user_id = u.user_id\n    AND o.pay_time >= DATE_SUB(NOW(), INTERVAL 30 DAY)\n)\nAND u.last_login >= DATE_SUB(NOW(), INTERVAL 7 DAY);", "columns_selectivity": "{\"users\":{\"user_id\":100%,\"username\":100%,\"last_login\":35.2940%,\"email\":100%,},\"orders\":{\"user_id\":77.9820%,\"pay_time\":35.2300%}}", "explain": "+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|   id | select_type        | table   | partitions   | type   | possible_keys   | key   | key_len   | ref   |   rows |   filtered | Extra       |\n+======+====================+=========+==============+========+=================+=======+===========+=======+========+============+=============+\n|    1 | PRIMARY            | u       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  |  99553 |      33.33 | Using where |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+\n|    2 | DEPENDENT SUBQUERY | o       | NULL         | ALL    | NULL            | NULL  | NULL      | NULL  | 497490 |       3.33 | Using where |\n+------+--------------------+---------+--------------+--------+-----------------+-------+-----------+-------+--------+------------+-------------+", "expected": "在orders表的user_id，pay_time列创建复合索引，user_id必须为最左列，并在users表的last_login列创建索引"}
{"case_id": "74","difficulty_level": "3", "description": "隐式类型转换的查询-隐式类型转换导致索引失效的前提是在索引列上进行转换，默认情况下MySQL的转换规则是将字符串转为数字", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * \nFROM users \nWHERE username = 1234;", "columns_selectivity": "{\"users\":{\"username\":100%}}", "explain": "|id |select_type|table|partitions|type|possible_keys|key|key_len|ref|rows  |filtered|Extra      |\n|---|-----------|-----|----------|----|-------------|---|-------|---|------|--------|-----------|\n|1  |SIMPLE     |users|          |ALL |             |   |       |   |99,494|10      |Using where|", "expected": "无法通过索引解决SQL存在的性能问题，存在隐式类型转换\n（隐式类型转换导致索引失效的前提是在索引列上进行转换，默认情况下MySQL的转换规则是将字符串转为数字）"}
{"case_id": "75","difficulty_level": "3", "description": "隐式类型转换的查询-隐式类型转换导致索引失效的前提是在索引列上进行转换，默认情况下MySQL的转换规则是将字符串转为数字", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT * \nFROM access_logs\nWHERE response_code = '200';", "columns_selectivity": "{\"access_logs\":{\"response_code\":0.006%}}", "explain": "|id |select_type|table      |partitions|type|possible_keys|key|key_len|ref|rows     |filtered|Extra      |\n|---|-----------|-----------|----------|----|-------------|---|-------|---|---------|--------|-----------|\n|1  |SIMPLE     |access_logs|          |ALL |             |   |       |   |1,988,985|10      |Using where|", "expected": "以下两种情况均可：\n1. 无法通过索引解决SQL性能问题，response_code 列选择性过低或存在隐式类型转换。\n2. 给access_logs表的response_code加索引。\n（隐式类型转换导致索引失效的前提是在索引列上进行转换，默认情况下MySQL的转换规则是将字符串转为数字，所以response_code的索引是有效的）"}
{"case_id": "76","difficulty_level": "3", "description": "隐式类型转换的查询-表字符集不一致，utf8mb4向下兼容utf8，如果驱动表(列)为utf8，被驱动表(列)为utf8mb4，是不存在隐式转换的，反之则需要隐式转换", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  phone VARCHAR(20),\n  delivery_company VARCHAR(50)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;", "sql": "SELECT u.username,u.email,o.order_sn,o.amount,o.ship_country,o.ship_city \nFROM users u\nleft join orders o on u.phone = o.phone \nwhere u.user_id = 100;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_sn\":100%,\"ship_city\":0.01%,\"ship_country\":0.01%},\"users\":{\"email\":100%,\"user_id\":100%,\"username\":100%}}", "explain": "|id |select_type|table|partitions|type |possible_keys|key    |key_len|ref  |rows   |filtered|Extra      |\n|---|-----------|-----|----------|-----|-------------|-------|-------|-----|-------|--------|-----------|\n|1  |SIMPLE     |u    |          |const|PRIMARY      |PRIMARY|8      |const|1      |100     |           |\n|1  |SIMPLE     |o    |          |ALL  |             |       |       |     |497,369|100     |Using where|", "expected": "以下两种情况均可\n1. 给 orders 表的 phone 列创建索引。\n（表字符集不一致，utf8mb4向下兼容utf8，如果驱动表(列)为utf8，被驱动表(列)为utf8mb4，是不存在隐式转换的，反之则需要隐式转换）\n2. 存在隐式类型转换，无法通过索引解决SQL性能问题"}
{"case_id": "77","difficulty_level": "3", "description": "隐式类型转换的查询-表字符集不一致，utf8mb4向下兼容utf8，如果驱动表(列)为utf8，被驱动表(列)为utf8mb4，是不存在隐式转换的，反之则需要隐式转换", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  phone VARCHAR(20),\n  delivery_company VARCHAR(50)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;", "sql": "SELECT u.username,u.email,o.order_sn,o.amount,o.ship_country,o.ship_city \nFROM users u\nleft join orders o on u.phone = o.phone \nwhere u.user_id = 100;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_sn\":100%,\"ship_city\":0.01%,\"ship_country\":0.01%},\"users\":{\"email\":100%,\"user_id\":100%,\"username\":100%}}", "explain": "|id |select_type|table|partitions|type |possible_keys|key    |key_len|ref  |rows   |filtered|Extra      |\n|---|-----------|-----|----------|-----|-------------|-------|-------|-----|-------|--------|-----------|\n|1  |SIMPLE     |u    |          |const|PRIMARY      |PRIMARY|8      |const|1      |100     |           |\n|1  |SIMPLE     |o    |          |ALL  |             |       |       |     |497,369|100     |Using where|", "expected": "无法通过索引解决SQL存在的性能问题，表字符集不一致，存在字符集隐式类型转换。（表字符集不一致，utf8mb4向下兼容utf8，如果驱动表(列)为utf8，被驱动表(列)为utf8mb4，是不存在隐式转换的，反之则需要隐式转换）"}
{"case_id": "78","difficulty_level": "2", "description": "谓词列带有函数或计算的查询-索引列使用函数，索引列计算导致索引失效", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT product_id, product_name\nFROM products \nWHERE UPPER(product_name) = 'SMARTPHONE';", "columns_selectivity": "{\"products\":{\"product_id\":100%,\"product_name\":100%}}", "explain": "|id |select_type|table   |partitions|type|possible_keys|key|key_len|ref|rows |filtered|Extra      |\n|---|-----------|--------|----------|----|-------------|---|-------|---|-----|--------|-----------|\n|1  |SIMPLE     |products|          |ALL |             |   |       |   |9,836|100     |Using where|", "expected": "以下两种情况均可：\n1. 无法通过索引解决SQL存在的性能问题,函数导致索引失效\n2. 在products表的 product_name 列创建单列索引（覆盖索引）"}
{"case_id": "79","difficulty_level": "2", "description": "谓词列带有函数或计算的查询-索引列使用函数，索引列计算导致索引失效", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT *\nFROM products \nWHERE stock + 1 = 100;", "columns_selectivity": "{\"products\":{\"stock\":10%}}", "explain": "|id |select_type|table   |partitions|type|possible_keys|key|key_len|ref|rows |filtered|Extra      |\n|---|-----------|--------|----------|----|-------------|---|-------|---|-----|--------|-----------|\n|1  |SIMPLE     |products|          |ALL |             |   |       |   |9,836|100     |Using where|", "expected": "无法通过索引解决SQL存在的性能问题，列计算会导致索引失效"}
{"case_id": "80","difficulty_level": "2", "description": "左右关联查询-识别驱动表，在被驱动表的关联列上创建索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT u.username,u.email,o.order_sn,o.amount,o.ship_country,o.ship_city \nFROM users u\nleft join orders o on u.user_id = o.user_id \nwhere o.user_id = 100;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_sn\":100%,\"ship_city\":0.01%,\"ship_country\":0.01%,\"user_id\":77.982%},\"users\":{\"email\":100%,\"username\":100%}}", "explain": "|id |select_type|table|partitions|type |possible_keys|key    |key_len|ref  |rows   |filtered|Extra      |\n|---|-----------|-----|----------|-----|-------------|-------|-------|-----|-------|--------|-----------|\n|1  |SIMPLE     |u    |          |const|PRIMARY      |PRIMARY|8      |const|1      |100     |           |\n|1  |SIMPLE     |o    |          |ALL  |             |       |       |     |497,658|10      |Using where|", "expected": "以下两种情况均可：\n1. 无法通过索引解决SQL存在的性能问题\n2. orders表创建覆盖索引，注意列顺序要求user_id在最左列\n3.创建单列索引，在orders表的user_id列创建索引"}
{"case_id": "81","difficulty_level": "2", "description": "左右关联查询-识别驱动表，在被驱动表的关联列上创建索引", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);\nCREATE TABLE orders (\n  order_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT NOT NULL,\n  order_sn VARCHAR(50) NOT NULL UNIQUE,\n  amount DECIMAL(12, 2) NOT NULL,\n  currency CHAR(3) DEFAULT 'CNY',\n  pay_time DATETIME,\n  ship_country VARCHAR(50),\n  ship_city VARCHAR(50),\n  ship_zip VARCHAR(20),\n  delivery_company VARCHAR(50)\n);", "sql": "SELECT u.username,u.email,o.order_sn,o.amount,o.ship_country,o.ship_city \nFROM users u\nright join orders o on u.user_id = o.user_id ;", "columns_selectivity": "{\"orders\":{\"amount\":94.296%,\"order_sn\":100%,\"ship_city\":0.01%,\"ship_country\":0.01%},\"users\":{\"email\":100%,\"username\":100%}}", "explain": "|id |select_type|table|partitions|type  |possible_keys|key    |key_len|ref                 |rows   |filtered|Extra|\n|---|-----------|-----|----------|------|-------------|-------|-------|--------------------|-------|--------|-----|\n|1  |SIMPLE     |o    |          |ALL   |             |       |       |                    |496,791|100     |     |\n|1  |SIMPLE     |u    |          |eq_ref|PRIMARY      |PRIMARY|8      |test_index.o.user_id|1      |100     |     |", "expected": "以下两种情况均可：\n1. 无法通过索引解决SQL存在的性能问题\n2. 给orders表的user_id，order_sn，amount，ship_country，ship_city 列添加覆盖索引"}
{"case_id": "82","difficulty_level": "3", "description": "UNION查询-union查询的索引建议，给独立查询分别建索引，但是外层的排序/分组导致的临时表和文件排序问题无法通过索引解决", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n  * \nFROM (\n  SELECT \n    * \n  FROM \n    access_logs \n  WHERE \n    request_url = '/api/v1/resource/247'\n  UNION\n  SELECT \n    * \n  FROM \n    access_logs \n  WHERE \n    ip_address = '192.168.52.116'\n) AS logs", "columns_selectivity": "{\"access_logs\":{\"ip_address\":69.5520%,\"request_url\":2.0000%}}", "explain": "|id |select_type |table      |partitions|type|possible_keys|key|key_len|ref|rows     |filtered|Extra          |\n|---|------------|-----------|----------|----|-------------|---|-------|---|---------|--------|---------------|\n|1  |PRIMARY     |<derived2> |          |ALL |             |   |       |   |397,796  |100     |               |\n|2  |DERIVED     |access_logs|          |ALL |             |   |       |   |1,988,985|10      |Using where    |\n|3  |UNION       |access_logs|          |ALL |             |   |       |   |1,988,985|10      |Using where    |\n|   |UNION RESULT|<union2,3> |          |ALL |             |   |       |   |         |        |Using temporary|", "expected": "在 access_logs 表分别给request_url和ip_address加单列索引"}
{"case_id": "83","difficulty_level": "3", "description": "UNION查询-union查询的索引建议，给独立查询分别建索引，但是外层的排序/分组导致的临时表和文件排序问题无法通过索引解决", "create_table_statements": "CREATE TABLE access_logs (\n  log_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id BIGINT,\n  request_url VARCHAR(500),\n  http_method VARCHAR(10),\n  response_code INT,\n  response_time_ms INT,\n  ip_address VARCHAR(50),\n  user_agent VARCHAR(200),\n  referrer VARCHAR(200),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);", "sql": "SELECT \n  * \nFROM (\n  SELECT \n    * \n  FROM \n    access_logs \n  WHERE \n    request_url = '/api/v1/resource/247'\n  UNION\n  SELECT \n    * \n  FROM \n    access_logs \n  WHERE \n    ip_address = '192.168.52.116'\n) AS logs\nORDER BY log_id,created_at;", "columns_selectivity": "{\"access_logs\":{\"ip_address\":69.5520%,\"request_url\":2.0000%,\"log_id\":100.0000%,\"created_at\"：0.0380%}}", "explain": "|id |select_type |table      |partitions|type|possible_keys|key|key_len|ref|rows     |filtered|Extra          |\n|---|------------|-----------|----------|----|-------------|---|-------|---|---------|--------|---------------|\n|1  |PRIMARY     |<derived2> |          |ALL |             |   |       |   |397,796  |100     |Using filesort |\n|2  |DERIVED     |access_logs|          |ALL |             |   |       |   |1,988,985|10      |Using where    |\n|3  |UNION       |access_logs|          |ALL |             |   |       |   |1,988,985|10      |Using where    |\n|   |UNION RESULT|<union2,3> |          |ALL |             |   |       |   |         |        |Using temporary|", "expected": "在 access_logs 表分别给request_url和ip_address加单列索引"}
{"case_id": "84","difficulty_level": "2", "description": "NULL查询-= NULL 会导致索引失效，IS NULL 不会导致索引失效", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT *\nFROM products\nwhere brand = NULL;", "columns_selectivity": "{\"products\":{\"brand\":0.05%}}", "explain": "|id |select_type|table   |partitions|type|possible_keys|key|key_len|ref|rows |filtered|Extra      |\n|---|-----------|--------|----------|----|-------------|---|-------|---|-----|--------|-----------|\n|1  |SIMPLE     |products|          |ALL |             |   |       |   |9,836|10      |Using where|", "expected": "= NULL 会导致索引失效，无法通过索引解决SQL性能问题"}
{"case_id": "85","difficulty_level": "2", "description": "NULL查询-= NULL 会导致索引失效，IS NULL 不会导致索引失效", "create_table_statements": "CREATE TABLE products (\n  product_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  product_name VARCHAR(200) NOT NULL,\n  category_id BIGINT NOT NULL,\n  brand VARCHAR(100),\n  origin_country VARCHAR(50),\n  price DECIMAL(10, 2) NOT NULL,\n  weight DECIMAL(10, 2),\n  stock INT NOT NULL,\n  is_imported BOOLEAN DEFAULT 0,\n  supplier_id BIGINT\n);", "sql": "SELECT *\nFROM products\nwhere brand IS NULL;", "columns_selectivity": "{\"products\":{\"brand\":5%}}", "explain": "|id |select_type|table   |partitions|type|possible_keys|key|key_len|ref|rows |filtered|Extra      |\n|---|-----------|--------|----------|----|-------------|---|-------|---|-----|--------|-----------|\n|1  |SIMPLE     |products|          |ALL |             |   |       |   |9,836|10      |Using where|", "expected": "以下两种情况均可：\n1. IS NULL 不会导致索引失效，在 products表的 brand 列上创建索引。\n2. 无性能问题。"}
{"case_id": "86","difficulty_level": "2", "description": "ORDER BY ASC DESC 复合排序-ASC DESC混合排序会导致索引失效", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT \n*\nFROM \n    users\nORDER BY \n    birthdate ASC, last_login DESC LIMIT 100;", "columns_selectivity": "{\"users\":{\"birthdated\":19.8760%,\"last_login\":35.2940%}}", "explain": "|id |select_type|table|partitions|type|possible_keys|key|key_len|ref|rows  |filtered|Extra         |\n|---|-----------|-----|----------|----|-------------|---|-------|---|------|--------|--------------|\n|1  |SIMPLE     |users|          |ALL |             |   |       |   |99,583|100     |Using filesort|", "expected": "ASC DESC混合排序会导致索引失效，无法通过索引解决SQL性能问题"}
{"case_id": "87","difficulty_level": "1", "description": "恒等条件-恒等条件和无条件若查询列数量在复合索引允许的范围内，可以使用覆盖索引，否则无法使用索引解决性能问题", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT * FROM users \nWHERE 1 = 1;", "columns_selectivity": "", "explain": "|id |select_type|table|partitions|type|possible_keys|key|key_len|ref|rows  |filtered|Extra|\n|---|-----------|-----|----------|----|-------------|---|-------|---|------|--------|-----|\n|1  |SIMPLE     |users|          |ALL |             |   |       |   |99,583|100     |     |", "expected": "无法通过索引解决SQL性能问题"}
{"case_id": "88","difficulty_level": "1", "description": "恒等条件-恒等条件和无条件若查询列数量在复合索引允许的范围内，可以使用覆盖索引，否则无法使用索引解决性能问题", "create_table_statements": "CREATE TABLE users (\n  user_id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(100) NOT NULL,\n  email VARCHAR(200) UNIQUE,\n  phone VARCHAR(20),\n  gender TINYINT,\n  birthdate DATE,\n  register_channel VARCHAR(50),\n  last_login DATETIME,\n  points INT DEFAULT 0,\n  vip_level TINYINT DEFAULT 0\n);", "sql": "SELECT user_id,username,birthdate FROM users \nWHERE 1 = 1;", "columns_selectivity": "{\"users\":{\"birthdate\":19.876%,\"user_id\":100%,\"username\":100%}}", "explain": "|id |select_type|table|partitions|type|possible_keys|key|key_len|ref|rows  |filtered|Extra|\n|---|-----------|-----|----------|----|-------------|---|-------|---|------|--------|-----|\n|1  |SIMPLE     |users|          |ALL |             |   |       |   |99,583|100     |     |", "expected": "以下两种情况均可\n1. 给users表的username,birthdate列创建复合索引\n2. 恒等where条件，无法通过索引解决SQL性能问题"}
